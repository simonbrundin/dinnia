import{T as pr,x as nt,y as vr,z as Gr,A as zr,B as Hr,S as Yr,K as O,O as Be,L as Jr,C as Qr}from"./entry.ae48a8f0.js";function Wr(t){return typeof t=="object"&&t!==null}function Xr(t,e){if(!Boolean(t))throw new Error(e??"Unexpected invariant triggered.")}const Zr=/\r\n|[\n\r]/g;function Tt(t,e){let r=0,n=1;for(const i of t.body.matchAll(Zr)){if(typeof i.index=="number"||Xr(!1),i.index>=e)break;r=i.index+i[0].length,n+=1}return{line:n,column:e+1-r}}function en(t){return yr(t.source,Tt(t.source,t.start))}function yr(t,e){const r=t.locationOffset.column-1,n="".padStart(r)+t.body,i=e.line-1,s=t.locationOffset.line-1,o=e.line+s,c=e.line===1?r:0,l=e.column+c,f=`${t.name}:${o}:${l}
`,u=n.split(/\r\n|[\n\r]/g),h=u[i];if(h.length>120){const d=Math.floor(l/80),y=l%80,v=[];for(let g=0;g<h.length;g+=80)v.push(h.slice(g,g+80));return f+Yt([[`${o} |`,v[0]],...v.slice(1,d+1).map(g=>["|",g]),["|","^".padStart(y)],["|",v[d+1]]])}return f+Yt([[`${o-1} |`,u[i-1]],[`${o} |`,h],["|","^".padStart(l)],[`${o+1} |`,u[i+1]]])}function Yt(t){const e=t.filter(([n,i])=>i!==void 0),r=Math.max(...e.map(([n])=>n.length));return e.map(([n,i])=>n.padStart(r)+(i?" "+i:"")).join(`
`)}function tn(t){const e=t[0];return e==null||"kind"in e||"length"in e?{nodes:e,source:t[1],positions:t[2],path:t[3],originalError:t[4],extensions:t[5]}:e}class Bt extends Error{constructor(e,...r){var n,i,s;const{nodes:o,source:c,positions:l,path:f,originalError:u,extensions:h}=tn(r);super(e),this.name="GraphQLError",this.path=f??void 0,this.originalError=u??void 0,this.nodes=Jt(Array.isArray(o)?o:o?[o]:void 0);const d=Jt((n=this.nodes)===null||n===void 0?void 0:n.map(v=>v.loc).filter(v=>v!=null));this.source=c??(d==null||(i=d[0])===null||i===void 0?void 0:i.source),this.positions=l??(d==null?void 0:d.map(v=>v.start)),this.locations=l&&c?l.map(v=>Tt(c,v)):d==null?void 0:d.map(v=>Tt(v.source,v.start));const y=Wr(u==null?void 0:u.extensions)?u==null?void 0:u.extensions:void 0;this.extensions=(s=h??y)!==null&&s!==void 0?s:Object.create(null),Object.defineProperties(this,{message:{writable:!0,enumerable:!0},name:{enumerable:!1},nodes:{enumerable:!1},source:{enumerable:!1},positions:{enumerable:!1},originalError:{enumerable:!1}}),u!=null&&u.stack?Object.defineProperty(this,"stack",{value:u.stack,writable:!0,configurable:!0}):Error.captureStackTrace?Error.captureStackTrace(this,Bt):Object.defineProperty(this,"stack",{value:Error().stack,writable:!0,configurable:!0})}get[Symbol.toStringTag](){return"GraphQLError"}toString(){let e=this.message;if(this.nodes)for(const r of this.nodes)r.loc&&(e+=`

`+en(r.loc));else if(this.source&&this.locations)for(const r of this.locations)e+=`

`+yr(this.source,r);return e}toJSON(){const e={message:this.message};return this.locations!=null&&(e.locations=this.locations),this.path!=null&&(e.path=this.path),this.extensions!=null&&Object.keys(this.extensions).length>0&&(e.extensions=this.extensions),e}}function Jt(t){return t===void 0||t.length===0?void 0:t}function Q(t,e,r){return new Bt(`Syntax Error: ${r}`,{source:t,positions:[e]})}var St;(function(t){t.QUERY="QUERY",t.MUTATION="MUTATION",t.SUBSCRIPTION="SUBSCRIPTION",t.FIELD="FIELD",t.FRAGMENT_DEFINITION="FRAGMENT_DEFINITION",t.FRAGMENT_SPREAD="FRAGMENT_SPREAD",t.INLINE_FRAGMENT="INLINE_FRAGMENT",t.VARIABLE_DEFINITION="VARIABLE_DEFINITION",t.SCHEMA="SCHEMA",t.SCALAR="SCALAR",t.OBJECT="OBJECT",t.FIELD_DEFINITION="FIELD_DEFINITION",t.ARGUMENT_DEFINITION="ARGUMENT_DEFINITION",t.INTERFACE="INTERFACE",t.UNION="UNION",t.ENUM="ENUM",t.ENUM_VALUE="ENUM_VALUE",t.INPUT_OBJECT="INPUT_OBJECT",t.INPUT_FIELD_DEFINITION="INPUT_FIELD_DEFINITION"})(St||(St={}));var m;(function(t){t.SOF="<SOF>",t.EOF="<EOF>",t.BANG="!",t.DOLLAR="$",t.AMP="&",t.PAREN_L="(",t.PAREN_R=")",t.SPREAD="...",t.COLON=":",t.EQUALS="=",t.AT="@",t.BRACKET_L="[",t.BRACKET_R="]",t.BRACE_L="{",t.PIPE="|",t.BRACE_R="}",t.NAME="Name",t.INT="Int",t.FLOAT="Float",t.STRING="String",t.BLOCK_STRING="BlockString",t.COMMENT="Comment"})(m||(m={}));class rn{constructor(e){const r=new pr(m.SOF,0,0,0,0);this.source=e,this.lastToken=r,this.token=r,this.line=1,this.lineStart=0}get[Symbol.toStringTag](){return"Lexer"}advance(){return this.lastToken=this.token,this.token=this.lookahead()}lookahead(){let e=this.token;if(e.kind!==m.EOF)do if(e.next)e=e.next;else{const r=sn(this,e.end);e.next=r,r.prev=e,e=r}while(e.kind===m.COMMENT);return e}}function nn(t){return t===m.BANG||t===m.DOLLAR||t===m.AMP||t===m.PAREN_L||t===m.PAREN_R||t===m.SPREAD||t===m.COLON||t===m.EQUALS||t===m.AT||t===m.BRACKET_L||t===m.BRACKET_R||t===m.BRACE_L||t===m.PIPE||t===m.BRACE_R}function Ae(t){return t>=0&&t<=55295||t>=57344&&t<=1114111}function ht(t,e){return mr(t.charCodeAt(e))&&gr(t.charCodeAt(e+1))}function mr(t){return t>=55296&&t<=56319}function gr(t){return t>=56320&&t<=57343}function pe(t,e){const r=t.source.body.codePointAt(e);if(r===void 0)return m.EOF;if(r>=32&&r<=126){const n=String.fromCodePoint(r);return n==='"'?`'"'`:`"${n}"`}return"U+"+r.toString(16).toUpperCase().padStart(4,"0")}function H(t,e,r,n,i){const s=t.line,o=1+r-t.lineStart;return new pr(e,r,n,s,o,i)}function sn(t,e){const r=t.source.body,n=r.length;let i=e;for(;i<n;){const s=r.charCodeAt(i);switch(s){case 65279:case 9:case 32:case 44:++i;continue;case 10:++i,++t.line,t.lineStart=i;continue;case 13:r.charCodeAt(i+1)===10?i+=2:++i,++t.line,t.lineStart=i;continue;case 35:return on(t,i);case 33:return H(t,m.BANG,i,i+1);case 36:return H(t,m.DOLLAR,i,i+1);case 38:return H(t,m.AMP,i,i+1);case 40:return H(t,m.PAREN_L,i,i+1);case 41:return H(t,m.PAREN_R,i,i+1);case 46:if(r.charCodeAt(i+1)===46&&r.charCodeAt(i+2)===46)return H(t,m.SPREAD,i,i+3);break;case 58:return H(t,m.COLON,i,i+1);case 61:return H(t,m.EQUALS,i,i+1);case 64:return H(t,m.AT,i,i+1);case 91:return H(t,m.BRACKET_L,i,i+1);case 93:return H(t,m.BRACKET_R,i,i+1);case 123:return H(t,m.BRACE_L,i,i+1);case 124:return H(t,m.PIPE,i,i+1);case 125:return H(t,m.BRACE_R,i,i+1);case 34:return r.charCodeAt(i+1)===34&&r.charCodeAt(i+2)===34?dn(t,i):cn(t,i)}if(nt(s)||s===45)return an(t,i,s);if(vr(s))return fn(t,i);throw Q(t.source,i,s===39?`Unexpected single quote character ('), did you mean to use a double quote (")?`:Ae(s)||ht(r,i)?`Unexpected character: ${pe(t,i)}.`:`Invalid character: ${pe(t,i)}.`)}return H(t,m.EOF,n,n)}function on(t,e){const r=t.source.body,n=r.length;let i=e+1;for(;i<n;){const s=r.charCodeAt(i);if(s===10||s===13)break;if(Ae(s))++i;else if(ht(r,i))i+=2;else break}return H(t,m.COMMENT,e,i,r.slice(e+1,i))}function an(t,e,r){const n=t.source.body;let i=e,s=r,o=!1;if(s===45&&(s=n.charCodeAt(++i)),s===48){if(s=n.charCodeAt(++i),nt(s))throw Q(t.source,i,`Invalid number, unexpected digit after 0: ${pe(t,i)}.`)}else i=mt(t,i,s),s=n.charCodeAt(i);if(s===46&&(o=!0,s=n.charCodeAt(++i),i=mt(t,i,s),s=n.charCodeAt(i)),(s===69||s===101)&&(o=!0,s=n.charCodeAt(++i),(s===43||s===45)&&(s=n.charCodeAt(++i)),i=mt(t,i,s),s=n.charCodeAt(i)),s===46||vr(s))throw Q(t.source,i,`Invalid number, expected digit but got: ${pe(t,i)}.`);return H(t,o?m.FLOAT:m.INT,e,i,n.slice(e,i))}function mt(t,e,r){if(!nt(r))throw Q(t.source,e,`Invalid number, expected digit but got: ${pe(t,e)}.`);const n=t.source.body;let i=e+1;for(;nt(n.charCodeAt(i));)++i;return i}function cn(t,e){const r=t.source.body,n=r.length;let i=e+1,s=i,o="";for(;i<n;){const c=r.charCodeAt(i);if(c===34)return o+=r.slice(s,i),H(t,m.STRING,e,i+1,o);if(c===92){o+=r.slice(s,i);const l=r.charCodeAt(i+1)===117?r.charCodeAt(i+2)===123?un(t,i):ln(t,i):hn(t,i);o+=l.value,i+=l.size,s=i;continue}if(c===10||c===13)break;if(Ae(c))++i;else if(ht(r,i))i+=2;else throw Q(t.source,i,`Invalid character within String: ${pe(t,i)}.`)}throw Q(t.source,i,"Unterminated string.")}function un(t,e){const r=t.source.body;let n=0,i=3;for(;i<12;){const s=r.charCodeAt(e+i++);if(s===125){if(i<5||!Ae(n))break;return{value:String.fromCodePoint(n),size:i}}if(n=n<<4|Ie(s),n<0)break}throw Q(t.source,e,`Invalid Unicode escape sequence: "${r.slice(e,e+i)}".`)}function ln(t,e){const r=t.source.body,n=Qt(r,e+2);if(Ae(n))return{value:String.fromCodePoint(n),size:6};if(mr(n)&&r.charCodeAt(e+6)===92&&r.charCodeAt(e+7)===117){const i=Qt(r,e+8);if(gr(i))return{value:String.fromCodePoint(n,i),size:12}}throw Q(t.source,e,`Invalid Unicode escape sequence: "${r.slice(e,e+6)}".`)}function Qt(t,e){return Ie(t.charCodeAt(e))<<12|Ie(t.charCodeAt(e+1))<<8|Ie(t.charCodeAt(e+2))<<4|Ie(t.charCodeAt(e+3))}function Ie(t){return t>=48&&t<=57?t-48:t>=65&&t<=70?t-55:t>=97&&t<=102?t-87:-1}function hn(t,e){const r=t.source.body;switch(r.charCodeAt(e+1)){case 34:return{value:'"',size:2};case 92:return{value:"\\",size:2};case 47:return{value:"/",size:2};case 98:return{value:"\b",size:2};case 102:return{value:"\f",size:2};case 110:return{value:`
`,size:2};case 114:return{value:"\r",size:2};case 116:return{value:"	",size:2}}throw Q(t.source,e,`Invalid character escape sequence: "${r.slice(e,e+2)}".`)}function dn(t,e){const r=t.source.body,n=r.length;let i=t.lineStart,s=e+3,o=s,c="";const l=[];for(;s<n;){const f=r.charCodeAt(s);if(f===34&&r.charCodeAt(s+1)===34&&r.charCodeAt(s+2)===34){c+=r.slice(o,s),l.push(c);const u=H(t,m.BLOCK_STRING,e,s+3,Gr(l).join(`
`));return t.line+=l.length-1,t.lineStart=i,u}if(f===92&&r.charCodeAt(s+1)===34&&r.charCodeAt(s+2)===34&&r.charCodeAt(s+3)===34){c+=r.slice(o,s),o=s+1,s+=4;continue}if(f===10||f===13){c+=r.slice(o,s),l.push(c),f===13&&r.charCodeAt(s+1)===10?s+=2:++s,c="",o=s,i=s;continue}if(Ae(f))++s;else if(ht(r,s))s+=2;else throw Q(t.source,s,`Invalid character within String: ${pe(t,s)}.`)}throw Q(t.source,s,"Unterminated string.")}function fn(t,e){const r=t.source.body,n=r.length;let i=e+1;for(;i<n;){const s=r.charCodeAt(i);if(zr(s))++i;else break}return H(t,m.NAME,e,i,r.slice(e,i))}function pn(t,e){return new vn(t,e).parseDocument()}class vn{constructor(e,r={}){const n=Hr(e)?e:new Yr(e);this._lexer=new rn(n),this._options=r,this._tokenCounter=0}parseName(){const e=this.expectToken(m.NAME);return this.node(e,{kind:O.NAME,value:e.value})}parseDocument(){return this.node(this._lexer.token,{kind:O.DOCUMENT,definitions:this.many(m.SOF,this.parseDefinition,m.EOF)})}parseDefinition(){if(this.peek(m.BRACE_L))return this.parseOperationDefinition();const e=this.peekDescription(),r=e?this._lexer.lookahead():this._lexer.token;if(r.kind===m.NAME){switch(r.value){case"schema":return this.parseSchemaDefinition();case"scalar":return this.parseScalarTypeDefinition();case"type":return this.parseObjectTypeDefinition();case"interface":return this.parseInterfaceTypeDefinition();case"union":return this.parseUnionTypeDefinition();case"enum":return this.parseEnumTypeDefinition();case"input":return this.parseInputObjectTypeDefinition();case"directive":return this.parseDirectiveDefinition()}if(e)throw Q(this._lexer.source,this._lexer.token.start,"Unexpected description, descriptions are supported only on type definitions.");switch(r.value){case"query":case"mutation":case"subscription":return this.parseOperationDefinition();case"fragment":return this.parseFragmentDefinition();case"extend":return this.parseTypeSystemExtension()}}throw this.unexpected(r)}parseOperationDefinition(){const e=this._lexer.token;if(this.peek(m.BRACE_L))return this.node(e,{kind:O.OPERATION_DEFINITION,operation:Be.QUERY,name:void 0,variableDefinitions:[],directives:[],selectionSet:this.parseSelectionSet()});const r=this.parseOperationType();let n;return this.peek(m.NAME)&&(n=this.parseName()),this.node(e,{kind:O.OPERATION_DEFINITION,operation:r,name:n,variableDefinitions:this.parseVariableDefinitions(),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()})}parseOperationType(){const e=this.expectToken(m.NAME);switch(e.value){case"query":return Be.QUERY;case"mutation":return Be.MUTATION;case"subscription":return Be.SUBSCRIPTION}throw this.unexpected(e)}parseVariableDefinitions(){return this.optionalMany(m.PAREN_L,this.parseVariableDefinition,m.PAREN_R)}parseVariableDefinition(){return this.node(this._lexer.token,{kind:O.VARIABLE_DEFINITION,variable:this.parseVariable(),type:(this.expectToken(m.COLON),this.parseTypeReference()),defaultValue:this.expectOptionalToken(m.EQUALS)?this.parseConstValueLiteral():void 0,directives:this.parseConstDirectives()})}parseVariable(){const e=this._lexer.token;return this.expectToken(m.DOLLAR),this.node(e,{kind:O.VARIABLE,name:this.parseName()})}parseSelectionSet(){return this.node(this._lexer.token,{kind:O.SELECTION_SET,selections:this.many(m.BRACE_L,this.parseSelection,m.BRACE_R)})}parseSelection(){return this.peek(m.SPREAD)?this.parseFragment():this.parseField()}parseField(){const e=this._lexer.token,r=this.parseName();let n,i;return this.expectOptionalToken(m.COLON)?(n=r,i=this.parseName()):i=r,this.node(e,{kind:O.FIELD,alias:n,name:i,arguments:this.parseArguments(!1),directives:this.parseDirectives(!1),selectionSet:this.peek(m.BRACE_L)?this.parseSelectionSet():void 0})}parseArguments(e){const r=e?this.parseConstArgument:this.parseArgument;return this.optionalMany(m.PAREN_L,r,m.PAREN_R)}parseArgument(e=!1){const r=this._lexer.token,n=this.parseName();return this.expectToken(m.COLON),this.node(r,{kind:O.ARGUMENT,name:n,value:this.parseValueLiteral(e)})}parseConstArgument(){return this.parseArgument(!0)}parseFragment(){const e=this._lexer.token;this.expectToken(m.SPREAD);const r=this.expectOptionalKeyword("on");return!r&&this.peek(m.NAME)?this.node(e,{kind:O.FRAGMENT_SPREAD,name:this.parseFragmentName(),directives:this.parseDirectives(!1)}):this.node(e,{kind:O.INLINE_FRAGMENT,typeCondition:r?this.parseNamedType():void 0,directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()})}parseFragmentDefinition(){const e=this._lexer.token;return this.expectKeyword("fragment"),this._options.allowLegacyFragmentVariables===!0?this.node(e,{kind:O.FRAGMENT_DEFINITION,name:this.parseFragmentName(),variableDefinitions:this.parseVariableDefinitions(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()}):this.node(e,{kind:O.FRAGMENT_DEFINITION,name:this.parseFragmentName(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()})}parseFragmentName(){if(this._lexer.token.value==="on")throw this.unexpected();return this.parseName()}parseValueLiteral(e){const r=this._lexer.token;switch(r.kind){case m.BRACKET_L:return this.parseList(e);case m.BRACE_L:return this.parseObject(e);case m.INT:return this.advanceLexer(),this.node(r,{kind:O.INT,value:r.value});case m.FLOAT:return this.advanceLexer(),this.node(r,{kind:O.FLOAT,value:r.value});case m.STRING:case m.BLOCK_STRING:return this.parseStringLiteral();case m.NAME:switch(this.advanceLexer(),r.value){case"true":return this.node(r,{kind:O.BOOLEAN,value:!0});case"false":return this.node(r,{kind:O.BOOLEAN,value:!1});case"null":return this.node(r,{kind:O.NULL});default:return this.node(r,{kind:O.ENUM,value:r.value})}case m.DOLLAR:if(e)if(this.expectToken(m.DOLLAR),this._lexer.token.kind===m.NAME){const n=this._lexer.token.value;throw Q(this._lexer.source,r.start,`Unexpected variable "$${n}" in constant value.`)}else throw this.unexpected(r);return this.parseVariable();default:throw this.unexpected()}}parseConstValueLiteral(){return this.parseValueLiteral(!0)}parseStringLiteral(){const e=this._lexer.token;return this.advanceLexer(),this.node(e,{kind:O.STRING,value:e.value,block:e.kind===m.BLOCK_STRING})}parseList(e){const r=()=>this.parseValueLiteral(e);return this.node(this._lexer.token,{kind:O.LIST,values:this.any(m.BRACKET_L,r,m.BRACKET_R)})}parseObject(e){const r=()=>this.parseObjectField(e);return this.node(this._lexer.token,{kind:O.OBJECT,fields:this.any(m.BRACE_L,r,m.BRACE_R)})}parseObjectField(e){const r=this._lexer.token,n=this.parseName();return this.expectToken(m.COLON),this.node(r,{kind:O.OBJECT_FIELD,name:n,value:this.parseValueLiteral(e)})}parseDirectives(e){const r=[];for(;this.peek(m.AT);)r.push(this.parseDirective(e));return r}parseConstDirectives(){return this.parseDirectives(!0)}parseDirective(e){const r=this._lexer.token;return this.expectToken(m.AT),this.node(r,{kind:O.DIRECTIVE,name:this.parseName(),arguments:this.parseArguments(e)})}parseTypeReference(){const e=this._lexer.token;let r;if(this.expectOptionalToken(m.BRACKET_L)){const n=this.parseTypeReference();this.expectToken(m.BRACKET_R),r=this.node(e,{kind:O.LIST_TYPE,type:n})}else r=this.parseNamedType();return this.expectOptionalToken(m.BANG)?this.node(e,{kind:O.NON_NULL_TYPE,type:r}):r}parseNamedType(){return this.node(this._lexer.token,{kind:O.NAMED_TYPE,name:this.parseName()})}peekDescription(){return this.peek(m.STRING)||this.peek(m.BLOCK_STRING)}parseDescription(){if(this.peekDescription())return this.parseStringLiteral()}parseSchemaDefinition(){const e=this._lexer.token,r=this.parseDescription();this.expectKeyword("schema");const n=this.parseConstDirectives(),i=this.many(m.BRACE_L,this.parseOperationTypeDefinition,m.BRACE_R);return this.node(e,{kind:O.SCHEMA_DEFINITION,description:r,directives:n,operationTypes:i})}parseOperationTypeDefinition(){const e=this._lexer.token,r=this.parseOperationType();this.expectToken(m.COLON);const n=this.parseNamedType();return this.node(e,{kind:O.OPERATION_TYPE_DEFINITION,operation:r,type:n})}parseScalarTypeDefinition(){const e=this._lexer.token,r=this.parseDescription();this.expectKeyword("scalar");const n=this.parseName(),i=this.parseConstDirectives();return this.node(e,{kind:O.SCALAR_TYPE_DEFINITION,description:r,name:n,directives:i})}parseObjectTypeDefinition(){const e=this._lexer.token,r=this.parseDescription();this.expectKeyword("type");const n=this.parseName(),i=this.parseImplementsInterfaces(),s=this.parseConstDirectives(),o=this.parseFieldsDefinition();return this.node(e,{kind:O.OBJECT_TYPE_DEFINITION,description:r,name:n,interfaces:i,directives:s,fields:o})}parseImplementsInterfaces(){return this.expectOptionalKeyword("implements")?this.delimitedMany(m.AMP,this.parseNamedType):[]}parseFieldsDefinition(){return this.optionalMany(m.BRACE_L,this.parseFieldDefinition,m.BRACE_R)}parseFieldDefinition(){const e=this._lexer.token,r=this.parseDescription(),n=this.parseName(),i=this.parseArgumentDefs();this.expectToken(m.COLON);const s=this.parseTypeReference(),o=this.parseConstDirectives();return this.node(e,{kind:O.FIELD_DEFINITION,description:r,name:n,arguments:i,type:s,directives:o})}parseArgumentDefs(){return this.optionalMany(m.PAREN_L,this.parseInputValueDef,m.PAREN_R)}parseInputValueDef(){const e=this._lexer.token,r=this.parseDescription(),n=this.parseName();this.expectToken(m.COLON);const i=this.parseTypeReference();let s;this.expectOptionalToken(m.EQUALS)&&(s=this.parseConstValueLiteral());const o=this.parseConstDirectives();return this.node(e,{kind:O.INPUT_VALUE_DEFINITION,description:r,name:n,type:i,defaultValue:s,directives:o})}parseInterfaceTypeDefinition(){const e=this._lexer.token,r=this.parseDescription();this.expectKeyword("interface");const n=this.parseName(),i=this.parseImplementsInterfaces(),s=this.parseConstDirectives(),o=this.parseFieldsDefinition();return this.node(e,{kind:O.INTERFACE_TYPE_DEFINITION,description:r,name:n,interfaces:i,directives:s,fields:o})}parseUnionTypeDefinition(){const e=this._lexer.token,r=this.parseDescription();this.expectKeyword("union");const n=this.parseName(),i=this.parseConstDirectives(),s=this.parseUnionMemberTypes();return this.node(e,{kind:O.UNION_TYPE_DEFINITION,description:r,name:n,directives:i,types:s})}parseUnionMemberTypes(){return this.expectOptionalToken(m.EQUALS)?this.delimitedMany(m.PIPE,this.parseNamedType):[]}parseEnumTypeDefinition(){const e=this._lexer.token,r=this.parseDescription();this.expectKeyword("enum");const n=this.parseName(),i=this.parseConstDirectives(),s=this.parseEnumValuesDefinition();return this.node(e,{kind:O.ENUM_TYPE_DEFINITION,description:r,name:n,directives:i,values:s})}parseEnumValuesDefinition(){return this.optionalMany(m.BRACE_L,this.parseEnumValueDefinition,m.BRACE_R)}parseEnumValueDefinition(){const e=this._lexer.token,r=this.parseDescription(),n=this.parseEnumValueName(),i=this.parseConstDirectives();return this.node(e,{kind:O.ENUM_VALUE_DEFINITION,description:r,name:n,directives:i})}parseEnumValueName(){if(this._lexer.token.value==="true"||this._lexer.token.value==="false"||this._lexer.token.value==="null")throw Q(this._lexer.source,this._lexer.token.start,`${Fe(this._lexer.token)} is reserved and cannot be used for an enum value.`);return this.parseName()}parseInputObjectTypeDefinition(){const e=this._lexer.token,r=this.parseDescription();this.expectKeyword("input");const n=this.parseName(),i=this.parseConstDirectives(),s=this.parseInputFieldsDefinition();return this.node(e,{kind:O.INPUT_OBJECT_TYPE_DEFINITION,description:r,name:n,directives:i,fields:s})}parseInputFieldsDefinition(){return this.optionalMany(m.BRACE_L,this.parseInputValueDef,m.BRACE_R)}parseTypeSystemExtension(){const e=this._lexer.lookahead();if(e.kind===m.NAME)switch(e.value){case"schema":return this.parseSchemaExtension();case"scalar":return this.parseScalarTypeExtension();case"type":return this.parseObjectTypeExtension();case"interface":return this.parseInterfaceTypeExtension();case"union":return this.parseUnionTypeExtension();case"enum":return this.parseEnumTypeExtension();case"input":return this.parseInputObjectTypeExtension()}throw this.unexpected(e)}parseSchemaExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("schema");const r=this.parseConstDirectives(),n=this.optionalMany(m.BRACE_L,this.parseOperationTypeDefinition,m.BRACE_R);if(r.length===0&&n.length===0)throw this.unexpected();return this.node(e,{kind:O.SCHEMA_EXTENSION,directives:r,operationTypes:n})}parseScalarTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("scalar");const r=this.parseName(),n=this.parseConstDirectives();if(n.length===0)throw this.unexpected();return this.node(e,{kind:O.SCALAR_TYPE_EXTENSION,name:r,directives:n})}parseObjectTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("type");const r=this.parseName(),n=this.parseImplementsInterfaces(),i=this.parseConstDirectives(),s=this.parseFieldsDefinition();if(n.length===0&&i.length===0&&s.length===0)throw this.unexpected();return this.node(e,{kind:O.OBJECT_TYPE_EXTENSION,name:r,interfaces:n,directives:i,fields:s})}parseInterfaceTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("interface");const r=this.parseName(),n=this.parseImplementsInterfaces(),i=this.parseConstDirectives(),s=this.parseFieldsDefinition();if(n.length===0&&i.length===0&&s.length===0)throw this.unexpected();return this.node(e,{kind:O.INTERFACE_TYPE_EXTENSION,name:r,interfaces:n,directives:i,fields:s})}parseUnionTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("union");const r=this.parseName(),n=this.parseConstDirectives(),i=this.parseUnionMemberTypes();if(n.length===0&&i.length===0)throw this.unexpected();return this.node(e,{kind:O.UNION_TYPE_EXTENSION,name:r,directives:n,types:i})}parseEnumTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("enum");const r=this.parseName(),n=this.parseConstDirectives(),i=this.parseEnumValuesDefinition();if(n.length===0&&i.length===0)throw this.unexpected();return this.node(e,{kind:O.ENUM_TYPE_EXTENSION,name:r,directives:n,values:i})}parseInputObjectTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("input");const r=this.parseName(),n=this.parseConstDirectives(),i=this.parseInputFieldsDefinition();if(n.length===0&&i.length===0)throw this.unexpected();return this.node(e,{kind:O.INPUT_OBJECT_TYPE_EXTENSION,name:r,directives:n,fields:i})}parseDirectiveDefinition(){const e=this._lexer.token,r=this.parseDescription();this.expectKeyword("directive"),this.expectToken(m.AT);const n=this.parseName(),i=this.parseArgumentDefs(),s=this.expectOptionalKeyword("repeatable");this.expectKeyword("on");const o=this.parseDirectiveLocations();return this.node(e,{kind:O.DIRECTIVE_DEFINITION,description:r,name:n,arguments:i,repeatable:s,locations:o})}parseDirectiveLocations(){return this.delimitedMany(m.PIPE,this.parseDirectiveLocation)}parseDirectiveLocation(){const e=this._lexer.token,r=this.parseName();if(Object.prototype.hasOwnProperty.call(St,r.value))return r;throw this.unexpected(e)}node(e,r){return this._options.noLocation!==!0&&(r.loc=new Jr(e,this._lexer.lastToken,this._lexer.source)),r}peek(e){return this._lexer.token.kind===e}expectToken(e){const r=this._lexer.token;if(r.kind===e)return this.advanceLexer(),r;throw Q(this._lexer.source,r.start,`Expected ${wr(e)}, found ${Fe(r)}.`)}expectOptionalToken(e){return this._lexer.token.kind===e?(this.advanceLexer(),!0):!1}expectKeyword(e){const r=this._lexer.token;if(r.kind===m.NAME&&r.value===e)this.advanceLexer();else throw Q(this._lexer.source,r.start,`Expected "${e}", found ${Fe(r)}.`)}expectOptionalKeyword(e){const r=this._lexer.token;return r.kind===m.NAME&&r.value===e?(this.advanceLexer(),!0):!1}unexpected(e){const r=e??this._lexer.token;return Q(this._lexer.source,r.start,`Unexpected ${Fe(r)}.`)}any(e,r,n){this.expectToken(e);const i=[];for(;!this.expectOptionalToken(n);)i.push(r.call(this));return i}optionalMany(e,r,n){if(this.expectOptionalToken(e)){const i=[];do i.push(r.call(this));while(!this.expectOptionalToken(n));return i}return[]}many(e,r,n){this.expectToken(e);const i=[];do i.push(r.call(this));while(!this.expectOptionalToken(n));return i}delimitedMany(e,r){this.expectOptionalToken(e);const n=[];do n.push(r.call(this));while(this.expectOptionalToken(e));return n}advanceLexer(){const{maxTokens:e}=this._options,r=this._lexer.advance();if(e!==void 0&&r.kind!==m.EOF&&(++this._tokenCounter,this._tokenCounter>e))throw Q(this._lexer.source,r.start,`Document contains more that ${e} tokens. Parsing aborted.`)}}function Fe(t){const e=t.value;return wr(t.kind)+(e!=null?` "${e}"`:"")}function wr(t){return nn(t)?`"${t}"`:t}function bt(t){this.message=t}bt.prototype=new Error,bt.prototype.name="InvalidCharacterError";var Wt=typeof window<"u"&&window.atob&&window.atob.bind(window)||function(t){var e=String(t).replace(/=+$/,"");if(e.length%4==1)throw new bt("'atob' failed: The string to be decoded is not correctly encoded.");for(var r,n,i=0,s=0,o="";n=e.charAt(s++);~n&&(r=i%4?64*r+n:n,i++%4)?o+=String.fromCharCode(255&r>>(-2*i&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return o};function yn(t){var e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Illegal base64url string!"}try{return function(r){return decodeURIComponent(Wt(r).replace(/(.)/g,function(n,i){var s=i.charCodeAt(0).toString(16).toUpperCase();return s.length<2&&(s="0"+s),"%"+s}))}(e)}catch{return Wt(e)}}function it(t){this.message=t}function mn(t,e){if(typeof t!="string")throw new it("Invalid token specified");var r=(e=e||{}).header===!0?0:1;try{return JSON.parse(yn(t.split(".")[r]))}catch(n){throw new it("Invalid token specified: "+n.message)}}it.prototype=new Error,it.prototype.name="InvalidTokenError";/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var E=function(){return E=Object.assign||function(e){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},E.apply(this,arguments)};function Ft(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]]);return r}function U(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function M(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(c){o={error:c}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return s}function V(t,e,r){if(r||arguments.length===2)for(var n=0,i=e.length,s;n<i;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return t.concat(s||Array.prototype.slice.call(e))}var $;(function(t){t.Start="xstate.start",t.Stop="xstate.stop",t.Raise="xstate.raise",t.Send="xstate.send",t.Cancel="xstate.cancel",t.NullEvent="",t.Assign="xstate.assign",t.After="xstate.after",t.DoneState="done.state",t.DoneInvoke="done.invoke",t.Log="xstate.log",t.Init="xstate.init",t.Invoke="xstate.invoke",t.ErrorExecution="error.execution",t.ErrorCommunication="error.communication",t.ErrorPlatform="error.platform",t.ErrorCustom="xstate.error",t.Update="xstate.update",t.Pure="xstate.pure",t.Choose="xstate.choose"})($||($={}));var be;(function(t){t.Parent="#_parent",t.Internal="#_internal"})(be||(be={}));var xt=$.Start,$t=$.Stop,Me=$.Raise,dt=$.Send,Er=$.Cancel,gn=$.NullEvent,Vt=$.Assign;$.After;$.DoneState;var Tr=$.Log,wn=$.Init,At=$.Invoke;$.ErrorExecution;var Xt=$.ErrorPlatform,En=$.ErrorCustom,Sr=$.Update,Tn=$.Choose,Sn=$.Pure,br=".",Zt={},kt="xstate.guard",bn="",Pe=!0,$e;function qt(t,e,r){r===void 0&&(r=br);var n=Ce(t,r),i=Ce(e,r);return F(i)?F(n)?i===n:!1:F(n)?n in i:Object.keys(n).every(function(s){return s in i?qt(n[s],i[s]):!1})}function xr(t){try{return F(t)||typeof t=="number"?"".concat(t):t.type}catch{throw new Error("Events must be strings or objects with a string event.type property.")}}function Ot(t,e){try{return ke(t)?t:t.toString().split(e)}catch{throw new Error("'".concat(t,"' is not a valid state path."))}}function xn(t){return typeof t=="object"&&"value"in t&&"context"in t&&"event"in t&&"_event"in t}function Ce(t,e){if(xn(t))return t.value;if(ke(t))return st(t);if(typeof t!="string")return t;var r=Ot(t,e);return st(r)}function st(t){if(t.length===1)return t[0];for(var e={},r=e,n=0;n<t.length-1;n++)n===t.length-2?r[t[n]]=t[n+1]:(r[t[n]]={},r=r[t[n]]);return e}function Ne(t,e){for(var r={},n=Object.keys(t),i=0;i<n.length;i++){var s=n[i];r[s]=e(t[s],s,t,i)}return r}function er(t,e,r){var n,i,s={};try{for(var o=U(Object.keys(t)),c=o.next();!c.done;c=o.next()){var l=c.value,f=t[l];r(f)&&(s[l]=e(f,l,t))}}catch(u){n={error:u}}finally{try{c&&!c.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return s}var An=function(t){return function(e){var r,n,i=e;try{for(var s=U(t),o=s.next();!o.done;o=s.next()){var c=o.value;i=i[c]}}catch(l){r={error:l}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return i}};function kn(t,e){return function(r){var n,i,s=r;try{for(var o=U(t),c=o.next();!c.done;c=o.next()){var l=c.value;s=s[e][l]}}catch(f){n={error:f}}finally{try{c&&!c.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return s}}function We(t){if(!t)return[[]];if(F(t))return[[t]];var e=z(Object.keys(t).map(function(r){var n=t[r];return typeof n!="string"&&(!n||!Object.keys(n).length)?[[r]]:We(t[r]).map(function(i){return[r].concat(i)})}));return e}function z(t){var e;return(e=[]).concat.apply(e,V([],M(t),!1))}function Ar(t){return ke(t)?t:[t]}function te(t){return t===void 0?[]:Ar(t)}function ot(t,e,r){var n,i;if(j(t))return t(e,r.data);var s={};try{for(var o=U(Object.keys(t)),c=o.next();!c.done;c=o.next()){var l=c.value,f=t[l];j(f)?s[l]=f(e,r.data):s[l]=f}}catch(u){n={error:u}}finally{try{c&&!c.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return s}function On(t){return/^(done|error)\./.test(t)}function tr(t){return!!(t instanceof Promise||t!==null&&(j(t)||typeof t=="object")&&j(t.then))}function In(t){return t!==null&&typeof t=="object"&&"transition"in t&&typeof t.transition=="function"}function Nn(t,e){var r,n,i=M([[],[]],2),s=i[0],o=i[1];try{for(var c=U(t),l=c.next();!l.done;l=c.next()){var f=l.value;e(f)?s.push(f):o.push(f)}}catch(u){r={error:u}}finally{try{l&&!l.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}return[s,o]}function kr(t,e){return Ne(t.states,function(r,n){if(r){var i=(F(e)?void 0:e[n])||(r?r.current:void 0);if(i)return{current:i,states:kr(r,i)}}})}function _n(t,e){return{current:e,states:kr(t,e)}}function rr(t,e,r,n){var i=t&&r.reduce(function(s,o){var c,l,f=o.assignment,u={state:n,action:o,_event:e},h={};if(j(f))h=f(s,e.data,u);else try{for(var d=U(Object.keys(f)),y=d.next();!y.done;y=d.next()){var v=y.value,g=f[v];h[v]=j(g)?g(s,e.data,u):g}}catch(A){c={error:A}}finally{try{y&&!y.done&&(l=d.return)&&l.call(d)}finally{if(c)throw c.error}}return Object.assign({},s,h)},t);return i}var It=function(){};function ke(t){return Array.isArray(t)}function j(t){return typeof t=="function"}function F(t){return typeof t=="string"}function Or(t,e){if(t)return F(t)?{type:kt,name:t,predicate:e?e[t]:void 0}:j(t)?{type:kt,name:t.name,predicate:t}:t}function Rn(t){try{return"subscribe"in t&&j(t.subscribe)}catch{return!1}}var ae=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();$e={},$e[ae]=function(){return this},$e[Symbol.observable]=function(){return this};function xe(t){return!!t&&"__xstatenode"in t}function Dn(t){return!!t&&typeof t.send=="function"}function ft(t,e){return F(t)||typeof t=="number"?E({type:t},e):t}function W(t,e){if(!F(t)&&"$$type"in t&&t.$$type==="scxml")return t;var r=ft(t);return E({name:r.type,data:r,$$type:"scxml",type:"external"},e)}function me(t,e){var r=Ar(e).map(function(n){return typeof n>"u"||typeof n=="string"||xe(n)?{target:n,event:t}:E(E({},n),{event:t})});return r}function Cn(t){if(!(t===void 0||t===bn))return te(t)}function Pn(t,e,r){if(!Pe){var n=t.stack?" Stacktrace was '".concat(t.stack,"'"):"";if(t===e)console.error("Missing onError handler for invocation '".concat(r,"', error was '").concat(t,"'.").concat(n));else{var i=e.stack?" Stacktrace was '".concat(e.stack,"'"):"";console.error("Missing onError handler and/or unhandled exception/promise rejection for invocation '".concat(r,"'. ")+"Original error: '".concat(t,"'. ").concat(n," Current error is '").concat(e,"'.").concat(i))}}}function Ir(t,e,r,n,i){var s=t.options.guards,o={state:i,cond:e,_event:n};if(e.type===kt)return((s==null?void 0:s[e.name])||e.predicate)(r,n.data,o);var c=s==null?void 0:s[e.type];if(!c)throw new Error("Guard '".concat(e.type,"' is not implemented on machine '").concat(t.id,"'."));return c(r,n.data,o)}function Nr(t){return typeof t=="string"?{type:t}:t}function Xe(t,e,r){var n=function(){},i=typeof t=="object",s=i?t:null;return{next:((i?t.next:t)||n).bind(s),error:((i?t.error:e)||n).bind(s),complete:((i?t.complete:r)||n).bind(s)}}function Ve(t,e){return"".concat(t,":invocation[").concat(e,"]")}function Nt(t){return(t.type===Me||t.type===dt&&t.to===be.Internal)&&typeof t.delay!="number"}var Se=W({type:wn});function _t(t,e){return e&&e[t]||void 0}function Ue(t,e){var r;if(F(t)||typeof t=="number"){var n=_t(t,e);j(n)?r={type:t,exec:n}:n?r=n:r={type:t,exec:void 0}}else if(j(t))r={type:t.name||t.toString(),exec:t};else{var n=_t(t.type,e);if(j(n))r=E(E({},t),{exec:n});else if(n){var i=n.type||t.type;r=E(E(E({},n),t),{type:i})}else r=t}return r}var ce=function(t,e){if(!t)return[];var r=ke(t)?t:[t];return r.map(function(n){return Ue(n,e)})};function Kt(t){var e=Ue(t);return E(E({id:F(t)?t:e.id},e),{type:e.type})}function Un(t,e){return{type:Me,event:typeof t=="function"?t:ft(t),delay:e?e.delay:void 0,id:e==null?void 0:e.id}}function Ln(t,e,r,n){var i={_event:r},s=W(j(t.event)?t.event(e,r.data,i):t.event),o;if(F(t.delay)){var c=n&&n[t.delay];o=j(c)?c(e,r.data,i):c}else o=j(t.delay)?t.delay(e,r.data,i):t.delay;return E(E({},t),{type:Me,_event:s,delay:o})}function _r(t,e){return{to:e?e.to:void 0,type:dt,event:j(t)?t:ft(t),delay:e?e.delay:void 0,id:e&&e.id!==void 0?e.id:j(t)?t.name:xr(t)}}function Mn(t,e,r,n){var i={_event:r},s=W(j(t.event)?t.event(e,r.data,i):t.event),o;if(F(t.delay)){var c=n&&n[t.delay];o=j(c)?c(e,r.data,i):c}else o=j(t.delay)?t.delay(e,r.data,i):t.delay;var l=j(t.to)?t.to(e,r.data,i):t.to;return E(E({},t),{to:l,_event:s,event:s.data,delay:o})}var jn=function(t,e,r){return E(E({},t),{value:F(t.expr)?t.expr:t.expr(e,r.data,{_event:r})})},Bn=function(t){return{type:Er,sendId:t}};function Fn(t){var e=Kt(t);return{type:$.Start,activity:e,exec:void 0}}function $n(t){var e=j(t)?t:Kt(t);return{type:$.Stop,activity:e,exec:void 0}}function Vn(t,e,r){var n=j(t.activity)?t.activity(e,r.data):t.activity,i=typeof n=="string"?{id:n}:n,s={type:$.Stop,activity:i};return s}var qn=function(t){return{type:Vt,assignment:t}};function Kn(t,e){var r=e?"#".concat(e):"";return"".concat($.After,"(").concat(t,")").concat(r)}function qe(t,e){var r="".concat($.DoneState,".").concat(t),n={type:r,data:e};return n.toString=function(){return r},n}function Ze(t,e){var r="".concat($.DoneInvoke,".").concat(t),n={type:r,data:e};return n.toString=function(){return r},n}function _e(t,e){var r="".concat($.ErrorPlatform,".").concat(t),n={type:r,data:e};return n.toString=function(){return r},n}var Gn=function(t){var e,r,n=[];try{for(var i=U(t),s=i.next();!s.done;s=i.next())for(var o=s.value,c=0;c<o.actions.length;){if(o.actions[c].type===Vt){n.push(o.actions[c]),o.actions.splice(c,1);continue}c++}}catch(l){e={error:l}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}return n};function at(t,e,r,n,i,s,o){o===void 0&&(o=!1);var c=o?[]:Gn(i),l=c.length?rr(r,n,c,e):r,f=o?[r]:void 0,u=[];function h(v,g){var A;switch(g.type){case Me:{var T=Ln(g,l,n,t.options.delays);return s&&typeof T.delay=="number"&&s(T,l,n),T}case dt:var S=Mn(g,l,n,t.options.delays);return s&&S.to!==be.Internal&&(v==="entry"?u.push(S):s(S,l,n)),S;case Tr:{var k=jn(g,l,n);return s==null||s(k,l,n),k}case Tn:{var I=g,C=(A=I.conds.find(function(w){var R=Or(w.cond,t.options.guards);return!R||Ir(t,R,l,n,s?void 0:e)}))===null||A===void 0?void 0:A.actions;if(!C)return[];var B=M(at(t,e,l,n,[{type:v,actions:ce(te(C),t.options.actions)}],s,o),2),P=B[0],N=B[1];return l=N,f==null||f.push(l),P}case Sn:{var C=g.get(l,n.data);if(!C)return[];var D=M(at(t,e,l,n,[{type:v,actions:ce(te(C),t.options.actions)}],s,o),2),q=D[0],x=D[1];return l=x,f==null||f.push(l),q}case $t:{var k=Vn(g,l,n);return s==null||s(k,r,n),k}case Vt:{l=rr(l,n,[g],s?void 0:e),f==null||f.push(l);break}default:var L=Ue(g,t.options.actions),K=L.exec;if(s)s(L,l,n);else if(K&&f){var a=f.length-1,p=E(E({},L),{exec:function(w){for(var R=[],_=1;_<arguments.length;_++)R[_-1]=arguments[_];K.apply(void 0,V([f[a]],M(R),!1))}});L=p}return L}}function d(v){var g,A,T=[];try{for(var S=U(v.actions),k=S.next();!k.done;k=S.next()){var I=k.value,C=h(v.type,I);C&&(T=T.concat(C))}}catch(B){g={error:B}}finally{try{k&&!k.done&&(A=S.return)&&A.call(S)}finally{if(g)throw g.error}}return u.forEach(function(B){s(B,l,n)}),u.length=0,T}var y=z(i.map(d));return[y,l]}var Ee=function(t,e){var r=e(t);return r};function Rr(t){var e;return e={id:t,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},getSnapshot:function(){},toJSON:function(){return{id:t}}},e[ae]=function(){return this},e}function zn(t,e,r,n){var i,s=Nr(t.src),o=(i=e==null?void 0:e.options.services)===null||i===void 0?void 0:i[s.type],c=t.data?ot(t.data,r,n):void 0,l=o?Dr(o,t.id,c):Rr(t.id);return l.meta=t,l}function Dr(t,e,r){var n=Rr(e);if(n.deferred=!0,xe(t)){var i=n.state=Ee(void 0,function(){return(r?t.withContext(r):t).initialState});n.getSnapshot=function(){return i}}return n}function Hn(t){try{return typeof t.send=="function"}catch{return!1}}function Yn(t){return Hn(t)&&"id"in t}function Jn(t){var e;return E((e={subscribe:function(){return{unsubscribe:function(){}}},id:"anonymous",getSnapshot:function(){}},e[ae]=function(){return this},e),t)}var ct=function(t){return t.type==="atomic"||t.type==="final"};function Cr(t){return Object.keys(t.states).map(function(e){return t.states[e]})}function Le(t){return Cr(t).filter(function(e){return e.type!=="history"})}function Pr(t){var e=[t];return ct(t)?e:e.concat(z(Le(t).map(Pr)))}function Re(t,e){var r,n,i,s,o,c,l,f,u=new Set(t),h=Rt(u),d=new Set(e);try{for(var y=U(d),v=y.next();!v.done;v=y.next())for(var g=v.value,A=g.parent;A&&!d.has(A);)d.add(A),A=A.parent}catch(D){r={error:D}}finally{try{v&&!v.done&&(n=y.return)&&n.call(y)}finally{if(r)throw r.error}}var T=Rt(d);try{for(var S=U(d),k=S.next();!k.done;k=S.next()){var g=k.value;if(g.type==="compound"&&(!T.get(g)||!T.get(g).length))h.get(g)?h.get(g).forEach(function(q){return d.add(q)}):g.initialStateNodes.forEach(function(q){return d.add(q)});else if(g.type==="parallel")try{for(var I=(o=void 0,U(Le(g))),C=I.next();!C.done;C=I.next()){var B=C.value;d.has(B)||(d.add(B),h.get(B)?h.get(B).forEach(function(q){return d.add(q)}):B.initialStateNodes.forEach(function(q){return d.add(q)}))}}catch(q){o={error:q}}finally{try{C&&!C.done&&(c=I.return)&&c.call(I)}finally{if(o)throw o.error}}}}catch(D){i={error:D}}finally{try{k&&!k.done&&(s=S.return)&&s.call(S)}finally{if(i)throw i.error}}try{for(var P=U(d),N=P.next();!N.done;N=P.next())for(var g=N.value,A=g.parent;A&&!d.has(A);)d.add(A),A=A.parent}catch(D){l={error:D}}finally{try{N&&!N.done&&(f=P.return)&&f.call(P)}finally{if(l)throw l.error}}return d}function Ur(t,e){var r=e.get(t);if(!r)return{};if(t.type==="compound"){var n=r[0];if(n){if(ct(n))return n.key}else return{}}var i={};return r.forEach(function(s){i[s.key]=Ur(s,e)}),i}function Rt(t){var e,r,n=new Map;try{for(var i=U(t),s=i.next();!s.done;s=i.next()){var o=s.value;n.has(o)||n.set(o,[]),o.parent&&(n.has(o.parent)||n.set(o.parent,[]),n.get(o.parent).push(o))}}catch(c){e={error:c}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}return n}function Qn(t,e){var r=Re([t],e);return Ur(t,Rt(r))}function De(t,e){return Array.isArray(t)?t.some(function(r){return r===e}):t instanceof Set?t.has(e):!1}function Wn(t){return V([],M(new Set(z(V([],M(t.map(function(e){return e.ownEvents})),!1)))),!1)}function et(t,e){return e.type==="compound"?Le(e).some(function(r){return r.type==="final"&&De(t,r)}):e.type==="parallel"?Le(e).every(function(r){return et(t,r)}):!1}function Xn(t){return t===void 0&&(t=[]),t.reduce(function(e,r){return r.meta!==void 0&&(e[r.id]=r.meta),e},{})}function nr(t){return new Set(z(t.map(function(e){return e.tags})))}function Lr(t,e){if(t===e)return!0;if(t===void 0||e===void 0)return!1;if(F(t)||F(e))return t===e;var r=Object.keys(t),n=Object.keys(e);return r.length===n.length&&r.every(function(i){return Lr(t[i],e[i])})}function Zn(t){return typeof t!="object"||t===null?!1:"value"in t&&"_event"in t}function ei(t,e){var r=t.exec,n=E(E({},t),{exec:r!==void 0?function(){return r(e.context,e.event,{action:t,state:e,_event:e._event})}:void 0});return n}var ne=function(){function t(e){var r=this,n;this.actions=[],this.activities=Zt,this.meta={},this.events=[],this.value=e.value,this.context=e.context,this._event=e._event,this._sessionid=e._sessionid,this.event=this._event.data,this.historyValue=e.historyValue,this.history=e.history,this.actions=e.actions||[],this.activities=e.activities||Zt,this.meta=Xn(e.configuration),this.events=e.events||[],this.matches=this.matches.bind(this),this.toStrings=this.toStrings.bind(this),this.configuration=e.configuration,this.transitions=e.transitions,this.children=e.children,this.done=!!e.done,this.tags=(n=Array.isArray(e.tags)?new Set(e.tags):e.tags)!==null&&n!==void 0?n:new Set,this.machine=e.machine,Object.defineProperty(this,"nextEvents",{get:function(){return Wn(r.configuration)}})}return t.from=function(e,r){if(e instanceof t)return e.context!==r?new t({value:e.value,context:r,_event:e._event,_sessionid:null,historyValue:e.historyValue,history:e.history,actions:[],activities:e.activities,meta:{},events:[],configuration:[],transitions:[],children:{}}):e;var n=Se;return new t({value:e,context:r,_event:n,_sessionid:null,historyValue:void 0,history:void 0,actions:[],activities:void 0,meta:void 0,events:[],configuration:[],transitions:[],children:{}})},t.create=function(e){return new t(e)},t.inert=function(e,r){if(e instanceof t){if(!e.actions.length)return e;var n=Se;return new t({value:e.value,context:r,_event:n,_sessionid:null,historyValue:e.historyValue,history:e.history,activities:e.activities,configuration:e.configuration,transitions:[],children:{}})}return t.from(e,r)},t.prototype.toStrings=function(e,r){var n=this;if(e===void 0&&(e=this.value),r===void 0&&(r="."),F(e))return[e];var i=Object.keys(e);return i.concat.apply(i,V([],M(i.map(function(s){return n.toStrings(e[s],r).map(function(o){return s+r+o})})),!1))},t.prototype.toJSON=function(){var e=this;e.configuration,e.transitions;var r=e.tags;e.machine;var n=Ft(e,["configuration","transitions","tags","machine"]);return E(E({},n),{tags:Array.from(r)})},t.prototype.matches=function(e){return qt(e,this.value)},t.prototype.hasTag=function(e){return this.tags.has(e)},t.prototype.can=function(e){var r;It(!!this.machine);var n=(r=this.machine)===null||r===void 0?void 0:r.getTransitionData(this,e);return!!(n!=null&&n.transitions.length)&&n.transitions.some(function(i){return i.target!==void 0||i.actions.length})},t}(),ti={deferEvents:!1},ir=function(){function t(e){this.processingEvent=!1,this.queue=[],this.initialized=!1,this.options=E(E({},ti),e)}return t.prototype.initialize=function(e){if(this.initialized=!0,e){if(!this.options.deferEvents){this.schedule(e);return}this.process(e)}this.flushEvents()},t.prototype.schedule=function(e){if(!this.initialized||this.processingEvent){this.queue.push(e);return}if(this.queue.length!==0)throw new Error("Event queue should be empty when it is not processing events");this.process(e),this.flushEvents()},t.prototype.clear=function(){this.queue=[]},t.prototype.flushEvents=function(){for(var e=this.queue.shift();e;)this.process(e),e=this.queue.shift()},t.prototype.process=function(e){this.processingEvent=!0;try{e()}catch(r){throw this.clear(),r}finally{this.processingEvent=!1}},t}(),gt=new Map,ri=0,Oe={bookId:function(){return"x:".concat(ri++)},register:function(t,e){return gt.set(t,e),t},get:function(t){return gt.get(t)},free:function(t){gt.delete(t)}};function Gt(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;Pe||console.warn("XState could not find a global object in this environment. Please let the maintainers know and raise an issue here: https://github.com/statelyai/xstate/issues")}function ni(){var t=Gt();if(t&&"__xstate__"in t)return globalThis.__xstate__}function ii(t){if(Gt()){var e=ni();e&&e.register(t)}}function si(t,e){e===void 0&&(e={});var r=t.initialState,n=new Set,i=[],s=!1,o=function(){if(!s){for(s=!0;i.length>0;){var f=i.shift();r=t.transition(r,f,l),n.forEach(function(u){return u.next(r)})}s=!1}},c=Jn({id:e.id,send:function(f){i.push(f),o()},getSnapshot:function(){return r},subscribe:function(f,u,h){var d=Xe(f,u,h);return n.add(d),d.next(r),{unsubscribe:function(){n.delete(d)}}}}),l={parent:e.parent,self:c,id:e.id||"anonymous",observers:n};return r=t.start?t.start(l):r,c}var oi={sync:!1,autoForward:!1},J;(function(t){t[t.NotStarted=0]="NotStarted",t[t.Running=1]="Running",t[t.Stopped=2]="Stopped"})(J||(J={}));var ai=function(){function t(e,r){r===void 0&&(r=t.defaultOptions);var n=this;this.machine=e,this.delayedEventsMap={},this.listeners=new Set,this.contextListeners=new Set,this.stopListeners=new Set,this.doneListeners=new Set,this.eventListeners=new Set,this.sendListeners=new Set,this.initialized=!1,this.status=J.NotStarted,this.children=new Map,this.forwardTo=new Set,this._outgoingQueue=[],this.init=this.start,this.send=function(u,h){if(ke(u))return n.batch(u),n.state;var d=W(ft(u,h));if(n.status===J.Stopped)return n.state;if(n.status!==J.Running&&!n.options.deferEvents)throw new Error('Event "'.concat(d.name,'" was sent to uninitialized service "').concat(n.machine.id,`". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.
Event: `).concat(JSON.stringify(d.data)));return n.scheduler.schedule(function(){n.forward(d);var y=n._nextState(d);n.update(y,d)}),n._state},this.sendTo=function(u,h,d){var y=n.parent&&(h===be.Parent||n.parent.id===h),v=y?n.parent:F(h)?h===be.Internal?n:n.children.get(h)||Oe.get(h):Dn(h)?h:void 0;if(!v){if(!y)throw new Error("Unable to send event to child '".concat(h,"' from service '").concat(n.id,"'."));return}if("machine"in v){if(n.status!==J.Stopped||n.parent!==v||n.state.done){var g=E(E({},u),{name:u.name===En?"".concat(_e(n.id)):u.name,origin:n.sessionId});!d&&n.machine.config.predictableActionArguments?n._outgoingQueue.push([v,g]):v.send(g)}}else!d&&n.machine.config.predictableActionArguments?n._outgoingQueue.push([v,u.data]):v.send(u.data)},this._exec=function(u,h,d,y){y===void 0&&(y=n.machine.options.actions);var v=u.exec||_t(u.type,y),g=j(v)?v:v?v.exec:u.exec;if(g)try{return g(h,d.data,n.machine.config.predictableActionArguments?{action:u,_event:d}:{action:u,state:n.state,_event:d})}catch(a){throw n.parent&&n.parent.send({type:"xstate.error",data:a}),a}switch(u.type){case Me:{var A=u;n.defer(A);break}case dt:var T=u;if(typeof T.delay=="number"){n.defer(T);return}else T.to?n.sendTo(T._event,T.to,d===Se):n.send(T._event);break;case Er:n.cancel(u.sendId);break;case xt:{if(n.status!==J.Running)return;var S=u.activity;if(!n.machine.config.predictableActionArguments&&!n.state.activities[S.id||S.type])break;if(S.type===$.Invoke){var k=Nr(S.src),I=n.machine.options.services?n.machine.options.services[k.type]:void 0,C=S.id,B=S.data,P="autoForward"in S?S.autoForward:!!S.forward;if(!I)return;var N=B?ot(B,h,d):void 0;if(typeof I=="string")return;var D=j(I)?I(h,d.data,{data:N,src:k,meta:S.meta}):I;if(!D)return;var q=void 0;xe(D)&&(D=N?D.withContext(N):D,q={autoForward:P}),n.spawn(D,C,q)}else n.spawnActivity(S);break}case $t:{n.stopChild(u.activity.id);break}case Tr:var x=u,L=x.label,K=x.value;L?n.logger(L,K):n.logger(K);break}};var i=E(E({},t.defaultOptions),r),s=i.clock,o=i.logger,c=i.parent,l=i.id,f=l!==void 0?l:e.id;this.id=f,this.logger=o,this.clock=s,this.parent=c,this.options=i,this.scheduler=new ir({deferEvents:this.options.deferEvents}),this.sessionId=Oe.bookId()}return Object.defineProperty(t.prototype,"initialState",{get:function(){var e=this;return this._initialState?this._initialState:Ee(this,function(){return e._initialState=e.machine.initialState,e._initialState})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),t.prototype.execute=function(e,r){var n,i;try{for(var s=U(e.actions),o=s.next();!o.done;o=s.next()){var c=o.value;this.exec(c,e,r)}}catch(l){n={error:l}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}},t.prototype.update=function(e,r){var n,i,s,o,c,l,f,u,h=this;if(e._sessionid=this.sessionId,this._state=e,(!this.machine.config.predictableActionArguments||r===Se)&&this.options.execute)this.execute(this.state);else for(var d=void 0;d=this._outgoingQueue.shift();)d[0].send(d[1]);if(this.children.forEach(function(D){h.state.children[D.id]=D}),this.devTools&&this.devTools.send(r.data,e),e.event)try{for(var y=U(this.eventListeners),v=y.next();!v.done;v=y.next()){var g=v.value;g(e.event)}}catch(D){n={error:D}}finally{try{v&&!v.done&&(i=y.return)&&i.call(y)}finally{if(n)throw n.error}}try{for(var A=U(this.listeners),T=A.next();!T.done;T=A.next()){var g=T.value;g(e,e.event)}}catch(D){s={error:D}}finally{try{T&&!T.done&&(o=A.return)&&o.call(A)}finally{if(s)throw s.error}}try{for(var S=U(this.contextListeners),k=S.next();!k.done;k=S.next()){var I=k.value;I(this.state.context,this.state.history?this.state.history.context:void 0)}}catch(D){c={error:D}}finally{try{k&&!k.done&&(l=S.return)&&l.call(S)}finally{if(c)throw c.error}}if(this.state.done){var C=e.configuration.find(function(D){return D.type==="final"&&D.parent===h.machine}),B=C&&C.doneData?ot(C.doneData,e.context,r):void 0;this._doneEvent=Ze(this.id,B);try{for(var P=U(this.doneListeners),N=P.next();!N.done;N=P.next()){var g=N.value;g(this._doneEvent)}}catch(D){f={error:D}}finally{try{N&&!N.done&&(u=P.return)&&u.call(P)}finally{if(f)throw f.error}}this._stop(),this._stopChildren(),Oe.free(this.sessionId)}},t.prototype.onTransition=function(e){return this.listeners.add(e),this.status===J.Running&&e(this.state,this.state.event),this},t.prototype.subscribe=function(e,r,n){var i=this,s=Xe(e,r,n);this.listeners.add(s.next),this.status!==J.NotStarted&&s.next(this.state);var o=function(){i.doneListeners.delete(o),i.stopListeners.delete(o),s.complete()};return this.status===J.Stopped?s.complete():(this.onDone(o),this.onStop(o)),{unsubscribe:function(){i.listeners.delete(s.next),i.doneListeners.delete(o),i.stopListeners.delete(o)}}},t.prototype.onEvent=function(e){return this.eventListeners.add(e),this},t.prototype.onSend=function(e){return this.sendListeners.add(e),this},t.prototype.onChange=function(e){return this.contextListeners.add(e),this},t.prototype.onStop=function(e){return this.stopListeners.add(e),this},t.prototype.onDone=function(e){return this.status===J.Stopped&&this._doneEvent?e(this._doneEvent):this.doneListeners.add(e),this},t.prototype.off=function(e){return this.listeners.delete(e),this.eventListeners.delete(e),this.sendListeners.delete(e),this.stopListeners.delete(e),this.doneListeners.delete(e),this.contextListeners.delete(e),this},t.prototype.start=function(e){var r=this;if(this.status===J.Running)return this;this.machine._init(),Oe.register(this.sessionId,this),this.initialized=!0,this.status=J.Running;var n=e===void 0?this.initialState:Ee(this,function(){return Zn(e)?r.machine.resolveState(e):r.machine.resolveState(ne.from(e,r.machine.context))});return this.options.devTools&&this.attachDev(),this.scheduler.initialize(function(){r.update(n,Se)}),this},t.prototype._stopChildren=function(){this.children.forEach(function(e){j(e.stop)&&e.stop()}),this.children.clear()},t.prototype._stop=function(){var e,r,n,i,s,o,c,l,f,u;try{for(var h=U(this.listeners),d=h.next();!d.done;d=h.next()){var y=d.value;this.listeners.delete(y)}}catch(P){e={error:P}}finally{try{d&&!d.done&&(r=h.return)&&r.call(h)}finally{if(e)throw e.error}}try{for(var v=U(this.stopListeners),g=v.next();!g.done;g=v.next()){var y=g.value;y(),this.stopListeners.delete(y)}}catch(P){n={error:P}}finally{try{g&&!g.done&&(i=v.return)&&i.call(v)}finally{if(n)throw n.error}}try{for(var A=U(this.contextListeners),T=A.next();!T.done;T=A.next()){var y=T.value;this.contextListeners.delete(y)}}catch(P){s={error:P}}finally{try{T&&!T.done&&(o=A.return)&&o.call(A)}finally{if(s)throw s.error}}try{for(var S=U(this.doneListeners),k=S.next();!k.done;k=S.next()){var y=k.value;this.doneListeners.delete(y)}}catch(P){c={error:P}}finally{try{k&&!k.done&&(l=S.return)&&l.call(S)}finally{if(c)throw c.error}}if(!this.initialized)return this;this.initialized=!1,this.status=J.Stopped,this._initialState=void 0;try{for(var I=U(Object.keys(this.delayedEventsMap)),C=I.next();!C.done;C=I.next()){var B=C.value;this.clock.clearTimeout(this.delayedEventsMap[B])}}catch(P){f={error:P}}finally{try{C&&!C.done&&(u=I.return)&&u.call(I)}finally{if(f)throw f.error}}this.scheduler.clear(),this.scheduler=new ir({deferEvents:this.options.deferEvents})},t.prototype.stop=function(){var e=this,r=this.scheduler;return this._stop(),r.schedule(function(){var n=W({type:"xstate.stop"}),i=Ee(e,function(){var s=z(V([],M(e.state.configuration),!1).sort(function(u,h){return h.order-u.order}).map(function(u){return ce(u.onExit,e.machine.options.actions)})),o=M(at(e.machine,e.state,e.state.context,n,[{type:"exit",actions:s}],e.machine.config.predictableActionArguments?e._exec:void 0,e.machine.config.predictableActionArguments||e.machine.config.preserveActionOrder),2),c=o[0],l=o[1],f=new ne({value:e.state.value,context:l,_event:n,_sessionid:e.sessionId,historyValue:void 0,history:e.state,actions:c.filter(function(u){return!Nt(u)}),activities:{},events:[],configuration:[],transitions:[],children:{},done:e.state.done,tags:e.state.tags,machine:e.machine});return f.changed=!0,f});e.update(i,n),e._stopChildren(),Oe.free(e.sessionId)}),this},t.prototype.batch=function(e){var r=this;if(this.status===J.NotStarted&&this.options.deferEvents)Pe||It(!1,"".concat(e.length,' event(s) were sent to uninitialized service "').concat(this.machine.id,`" and are deferred. Make sure .start() is called for this service.
Event: `).concat(JSON.stringify(event)));else if(this.status!==J.Running)throw new Error("".concat(e.length,' event(s) were sent to uninitialized service "').concat(this.machine.id,'". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.'));if(e.length){var n=!!this.machine.config.predictableActionArguments&&this._exec;this.scheduler.schedule(function(){var i,s,o=r.state,c=!1,l=[],f=function(y){var v=W(y);r.forward(v),o=Ee(r,function(){return r.machine.transition(o,v,void 0,n||void 0)}),l.push.apply(l,V([],M(r.machine.config.predictableActionArguments?o.actions:o.actions.map(function(g){return ei(g,o)})),!1)),c=c||!!o.changed};try{for(var u=U(e),h=u.next();!h.done;h=u.next()){var d=h.value;f(d)}}catch(y){i={error:y}}finally{try{h&&!h.done&&(s=u.return)&&s.call(u)}finally{if(i)throw i.error}}o.changed=c,o.actions=l,r.update(o,W(e[e.length-1]))})}},t.prototype.sender=function(e){return this.send.bind(this,e)},t.prototype._nextState=function(e,r){var n=this;r===void 0&&(r=!!this.machine.config.predictableActionArguments&&this._exec);var i=W(e);if(i.name.indexOf(Xt)===0&&!this.state.nextEvents.some(function(o){return o.indexOf(Xt)===0}))throw i.data.data;var s=Ee(this,function(){return n.machine.transition(n.state,i,void 0,r||void 0)});return s},t.prototype.nextState=function(e){return this._nextState(e,!1)},t.prototype.forward=function(e){var r,n;try{for(var i=U(this.forwardTo),s=i.next();!s.done;s=i.next()){var o=s.value,c=this.children.get(o);if(!c)throw new Error("Unable to forward event '".concat(e,"' from interpreter '").concat(this.id,"' to nonexistant child '").concat(o,"'."));c.send(e)}}catch(l){r={error:l}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}},t.prototype.defer=function(e){var r=this,n=this.clock.setTimeout(function(){"to"in e&&e.to?r.sendTo(e._event,e.to,!0):r.send(e._event)},e.delay);e.id&&(this.delayedEventsMap[e.id]=n)},t.prototype.cancel=function(e){this.clock.clearTimeout(this.delayedEventsMap[e]),delete this.delayedEventsMap[e]},t.prototype.exec=function(e,r,n){n===void 0&&(n=this.machine.options.actions),this._exec(e,r.context,r._event,n)},t.prototype.removeChild=function(e){var r;this.children.delete(e),this.forwardTo.delete(e),(r=this.state)===null||r===void 0||delete r.children[e]},t.prototype.stopChild=function(e){var r=this.children.get(e);r&&(this.removeChild(e),j(r.stop)&&r.stop())},t.prototype.spawn=function(e,r,n){if(this.status!==J.Running)return Dr(e,r);if(tr(e))return this.spawnPromise(Promise.resolve(e),r);if(j(e))return this.spawnCallback(e,r);if(Yn(e))return this.spawnActor(e,r);if(Rn(e))return this.spawnObservable(e,r);if(xe(e))return this.spawnMachine(e,E(E({},n),{id:r}));if(In(e))return this.spawnBehavior(e,r);throw new Error('Unable to spawn entity "'.concat(r,'" of type "').concat(typeof e,'".'))},t.prototype.spawnMachine=function(e,r){var n=this;r===void 0&&(r={});var i=new t(e,E(E({},this.options),{parent:this,id:r.id||e.id})),s=E(E({},oi),r);s.sync&&i.onTransition(function(c){n.send(Sr,{state:c,id:i.id})});var o=i;return this.children.set(i.id,o),s.autoForward&&this.forwardTo.add(i.id),i.onDone(function(c){n.removeChild(i.id),n.send(W(c,{origin:i.id}))}).start(),o},t.prototype.spawnBehavior=function(e,r){var n=si(e,{id:r,parent:this});return this.children.set(r,n),n},t.prototype.spawnPromise=function(e,r){var n,i=this,s=!1,o;e.then(function(l){s||(o=l,i.removeChild(r),i.send(W(Ze(r,l),{origin:r})))},function(l){if(!s){i.removeChild(r);var f=_e(r,l);try{i.send(W(f,{origin:r}))}catch(u){Pn(l,u,r),i.devTools&&i.devTools.send(f,i.state),i.machine.strict&&i.stop()}}});var c=(n={id:r,send:function(){},subscribe:function(l,f,u){var h=Xe(l,f,u),d=!1;return e.then(function(y){d||(h.next(y),!d&&h.complete())},function(y){d||h.error(y)}),{unsubscribe:function(){return d=!0}}},stop:function(){s=!0},toJSON:function(){return{id:r}},getSnapshot:function(){return o}},n[ae]=function(){return this},n);return this.children.set(r,c),c},t.prototype.spawnCallback=function(e,r){var n,i=this,s=!1,o=new Set,c=new Set,l,f=function(d){l=d,c.forEach(function(y){return y(d)}),!s&&i.send(W(d,{origin:r}))},u;try{u=e(f,function(d){o.add(d)})}catch(d){this.send(_e(r,d))}if(tr(u))return this.spawnPromise(u,r);var h=(n={id:r,send:function(d){return o.forEach(function(y){return y(d)})},subscribe:function(d){var y=Xe(d);return c.add(y.next),{unsubscribe:function(){c.delete(y.next)}}},stop:function(){s=!0,j(u)&&u()},toJSON:function(){return{id:r}},getSnapshot:function(){return l}},n[ae]=function(){return this},n);return this.children.set(r,h),h},t.prototype.spawnObservable=function(e,r){var n,i=this,s,o=e.subscribe(function(l){s=l,i.send(W(l,{origin:r}))},function(l){i.removeChild(r),i.send(W(_e(r,l),{origin:r}))},function(){i.removeChild(r),i.send(W(Ze(r),{origin:r}))}),c=(n={id:r,send:function(){},subscribe:function(l,f,u){return e.subscribe(l,f,u)},stop:function(){return o.unsubscribe()},getSnapshot:function(){return s},toJSON:function(){return{id:r}}},n[ae]=function(){return this},n);return this.children.set(r,c),c},t.prototype.spawnActor=function(e,r){return this.children.set(r,e),e},t.prototype.spawnActivity=function(e){var r=this.machine.options&&this.machine.options.activities?this.machine.options.activities[e.type]:void 0;if(!r){Pe||It(!1,"No implementation found for activity '".concat(e.type,"'"));return}var n=r(this.state.context,e);this.spawnEffect(e.id,n)},t.prototype.spawnEffect=function(e,r){var n;this.children.set(e,(n={id:e,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},stop:r||void 0,getSnapshot:function(){},toJSON:function(){return{id:e}}},n[ae]=function(){return this},n))},t.prototype.attachDev=function(){var e=Gt();if(this.options.devTools&&e){if(e.__REDUX_DEVTOOLS_EXTENSION__){var r=typeof this.options.devTools=="object"?this.options.devTools:void 0;this.devTools=e.__REDUX_DEVTOOLS_EXTENSION__.connect(E(E({name:this.id,autoPause:!0,stateSanitizer:function(n){return{value:n.value,context:n.context,actions:n.actions}}},r),{features:E({jump:!1,skip:!1},r?r.features:void 0)}),this.machine),this.devTools.init(this.state)}ii(this)}},t.prototype.toJSON=function(){return{id:this.id}},t.prototype[ae]=function(){return this},t.prototype.getSnapshot=function(){return this.status===J.NotStarted?this.initialState:this._state},t.defaultOptions={execute:!0,deferEvents:!0,clock:{setTimeout:function(e,r){return setTimeout(e,r)},clearTimeout:function(e){return clearTimeout(e)}},logger:console.log.bind(console),devTools:!1},t.interpret=Te,t}();function Te(t,e){var r=new ai(t,e);return r}function ci(t){if(typeof t=="string"){var e={type:t};return e.toString=function(){return t},e}return t}function Ke(t){return E(E({type:At},t),{toJSON:function(){t.onDone,t.onError;var e=Ft(t,["onDone","onError"]);return E(E({},e),{type:At,src:ci(t.src)})}})}var Ge="",Dt="#",wt="*",ge={},we=function(t){return t[0]===Dt},ui=function(){return{actions:{},guards:{},services:{},activities:{},delays:{}}},li=function(){function t(e,r,n,i){n===void 0&&(n="context"in e?e.context:void 0);var s=this,o;this.config=e,this._context=n,this.order=-1,this.__xstatenode=!0,this.__cache={events:void 0,relativeValue:new Map,initialStateValue:void 0,initialState:void 0,on:void 0,transitions:void 0,candidates:{},delayedTransitions:void 0},this.idMap={},this.tags=[],this.options=Object.assign(ui(),r),this.parent=i==null?void 0:i.parent,this.key=this.config.key||(i==null?void 0:i.key)||this.config.id||"(machine)",this.machine=this.parent?this.parent.machine:this,this.path=this.parent?this.parent.path.concat(this.key):[],this.delimiter=this.config.delimiter||(this.parent?this.parent.delimiter:br),this.id=this.config.id||V([this.machine.key],M(this.path),!1).join(this.delimiter),this.version=this.parent?this.parent.version:this.config.version,this.type=this.config.type||(this.config.parallel?"parallel":this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.schema=this.parent?this.machine.schema:(o=this.config.schema)!==null&&o!==void 0?o:{},this.description=this.config.description,this.initial=this.config.initial,this.states=this.config.states?Ne(this.config.states,function(f,u){var h,d=new t(f,{},void 0,{parent:s,key:u});return Object.assign(s.idMap,E((h={},h[d.id]=d,h),d.idMap)),d}):ge;var c=0;function l(f){var u,h;f.order=c++;try{for(var d=U(Cr(f)),y=d.next();!y.done;y=d.next()){var v=y.value;l(v)}}catch(g){u={error:g}}finally{try{y&&!y.done&&(h=d.return)&&h.call(d)}finally{if(u)throw u.error}}}l(this),this.history=this.config.history===!0?"shallow":this.config.history||!1,this._transient=!!this.config.always||(this.config.on?Array.isArray(this.config.on)?this.config.on.some(function(f){var u=f.event;return u===Ge}):Ge in this.config.on:!1),this.strict=!!this.config.strict,this.onEntry=te(this.config.entry||this.config.onEntry).map(function(f){return Ue(f)}),this.onExit=te(this.config.exit||this.config.onExit).map(function(f){return Ue(f)}),this.meta=this.config.meta,this.doneData=this.type==="final"?this.config.data:void 0,this.invoke=te(this.config.invoke).map(function(f,u){var h,d;if(xe(f)){var y=Ve(s.id,u);return s.machine.options.services=E((h={},h[y]=f,h),s.machine.options.services),Ke({src:y,id:y})}else if(F(f.src)){var y=f.id||Ve(s.id,u);return Ke(E(E({},f),{id:y,src:f.src}))}else if(xe(f.src)||j(f.src)){var y=f.id||Ve(s.id,u);return s.machine.options.services=E((d={},d[y]=f.src,d),s.machine.options.services),Ke(E(E({id:y},f),{src:y}))}else{var v=f.src;return Ke(E(E({id:Ve(s.id,u)},f),{src:v}))}}),this.activities=te(this.config.activities).concat(this.invoke).map(function(f){return Kt(f)}),this.transition=this.transition.bind(this),this.tags=te(this.config.tags)}return t.prototype._init=function(){this.__cache.transitions||Pr(this).forEach(function(e){return e.on})},t.prototype.withConfig=function(e,r){var n=this.options,i=n.actions,s=n.activities,o=n.guards,c=n.services,l=n.delays;return new t(this.config,{actions:E(E({},i),e.actions),activities:E(E({},s),e.activities),guards:E(E({},o),e.guards),services:E(E({},c),e.services),delays:E(E({},l),e.delays)},r??this.context)},t.prototype.withContext=function(e){return new t(this.config,this.options,e)},Object.defineProperty(t.prototype,"context",{get:function(){return j(this._context)?this._context():this._context},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"definition",{get:function(){return{id:this.id,key:this.key,version:this.version,context:this.context,type:this.type,initial:this.initial,history:this.history,states:Ne(this.states,function(e){return e.definition}),on:this.on,transitions:this.transitions,entry:this.onEntry,exit:this.onExit,activities:this.activities||[],meta:this.meta,order:this.order||-1,data:this.doneData,invoke:this.invoke,description:this.description,tags:this.tags}},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return this.definition},Object.defineProperty(t.prototype,"on",{get:function(){if(this.__cache.on)return this.__cache.on;var e=this.transitions;return this.__cache.on=e.reduce(function(r,n){return r[n.eventType]=r[n.eventType]||[],r[n.eventType].push(n),r},{})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"after",{get:function(){return this.__cache.delayedTransitions||(this.__cache.delayedTransitions=this.getDelayedTransitions(),this.__cache.delayedTransitions)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transitions",{get:function(){return this.__cache.transitions||(this.__cache.transitions=this.formatTransitions(),this.__cache.transitions)},enumerable:!1,configurable:!0}),t.prototype.getCandidates=function(e){if(this.__cache.candidates[e])return this.__cache.candidates[e];var r=e===Ge,n=this.transitions.filter(function(i){var s=i.eventType===e;return r?s:s||i.eventType===wt});return this.__cache.candidates[e]=n,n},t.prototype.getDelayedTransitions=function(){var e=this,r=this.config.after;if(!r)return[];var n=function(s,o){var c=j(s)?"".concat(e.id,":delay[").concat(o,"]"):s,l=Kn(c,e.id);return e.onEntry.push(_r(l,{delay:s})),e.onExit.push(Bn(l)),l},i=ke(r)?r.map(function(s,o){var c=n(s.delay,o);return E(E({},s),{event:c})}):z(Object.keys(r).map(function(s,o){var c=r[s],l=F(c)?{target:c}:c,f=isNaN(+s)?s:+s,u=n(f,o);return te(l).map(function(h){return E(E({},h),{event:u,delay:f})})}));return i.map(function(s){var o=s.delay;return E(E({},e.formatTransition(s)),{delay:o})})},t.prototype.getStateNodes=function(e){var r,n=this;if(!e)return[];var i=e instanceof ne?e.value:Ce(e,this.delimiter);if(F(i)){var s=this.getStateNode(i).initial;return s!==void 0?this.getStateNodes((r={},r[i]=s,r)):[this,this.states[i]]}var o=Object.keys(i),c=[this];return c.push.apply(c,V([],M(z(o.map(function(l){return n.getStateNode(l).getStateNodes(i[l])}))),!1)),c},t.prototype.handles=function(e){var r=xr(e);return this.events.includes(r)},t.prototype.resolveState=function(e){var r=e instanceof ne?e:ne.create(e),n=Array.from(Re([],this.getStateNodes(r.value)));return new ne(E(E({},r),{value:this.resolve(r.value),configuration:n,done:et(n,this),tags:nr(n),machine:this.machine}))},t.prototype.transitionLeafNode=function(e,r,n){var i=this.getStateNode(e),s=i.next(r,n);return!s||!s.transitions.length?this.next(r,n):s},t.prototype.transitionCompoundNode=function(e,r,n){var i=Object.keys(e),s=this.getStateNode(i[0]),o=s._transition(e[i[0]],r,n);return!o||!o.transitions.length?this.next(r,n):o},t.prototype.transitionParallelNode=function(e,r,n){var i,s,o={};try{for(var c=U(Object.keys(e)),l=c.next();!l.done;l=c.next()){var f=l.value,u=e[f];if(u){var h=this.getStateNode(f),d=h._transition(u,r,n);d&&(o[f]=d)}}}catch(T){i={error:T}}finally{try{l&&!l.done&&(s=c.return)&&s.call(c)}finally{if(i)throw i.error}}var y=Object.keys(o).map(function(T){return o[T]}),v=z(y.map(function(T){return T.transitions})),g=y.some(function(T){return T.transitions.length>0});if(!g)return this.next(r,n);var A=z(Object.keys(o).map(function(T){return o[T].configuration}));return{transitions:v,exitSet:z(y.map(function(T){return T.exitSet})),configuration:A,source:r,actions:z(Object.keys(o).map(function(T){return o[T].actions}))}},t.prototype._transition=function(e,r,n){return F(e)?this.transitionLeafNode(e,r,n):Object.keys(e).length===1?this.transitionCompoundNode(e,r,n):this.transitionParallelNode(e,r,n)},t.prototype.getTransitionData=function(e,r){return this._transition(e.value,e,W(r))},t.prototype.next=function(e,r){var n,i,s=this,o=r.name,c=[],l=[],f;try{for(var u=U(this.getCandidates(o)),h=u.next();!h.done;h=u.next()){var d=h.value,y=d.cond,v=d.in,g=e.context,A=v?F(v)&&we(v)?e.matches(Ce(this.getStateNodeById(v).path,this.delimiter)):qt(Ce(v,this.delimiter),An(this.path.slice(0,-2))(e.value)):!0,T=!1;try{T=!y||Ir(this.machine,y,g,r,e)}catch(I){throw new Error("Unable to evaluate guard '".concat(y.name||y.type,"' in transition for event '").concat(o,"' in state node '").concat(this.id,`':
`).concat(I.message))}if(T&&A){d.target!==void 0&&(l=d.target),c.push.apply(c,V([],M(d.actions),!1)),f=d;break}}}catch(I){n={error:I}}finally{try{h&&!h.done&&(i=u.return)&&i.call(u)}finally{if(n)throw n.error}}if(f){if(!l.length)return{transitions:[f],exitSet:[],configuration:e.value?[this]:[],source:e,actions:c};var S=z(l.map(function(I){return s.getRelativeStateNodes(I,e.historyValue)})),k=!!f.internal;return{transitions:[f],exitSet:k?[]:z(l.map(function(I){return s.getPotentiallyReenteringNodes(I)})),configuration:S,source:e,actions:c}}},t.prototype.getPotentiallyReenteringNodes=function(e){if(this.order<e.order)return[this];for(var r=[],n=this,i=e;n&&n!==i;)r.push(n),n=n.parent;return n!==i?[]:(r.push(i),r)},t.prototype.getActions=function(e,r,n,i,s,o,c){var l,f,u,h,d=this,y=o?Re([],this.getStateNodes(o.value)):[],v=new Set;try{for(var g=U(Array.from(e).sort(function(x,L){return x.order-L.order})),A=g.next();!A.done;A=g.next()){var T=A.value;(!De(y,T)||De(n.exitSet,T)||T.parent&&v.has(T.parent))&&v.add(T)}}catch(x){l={error:x}}finally{try{A&&!A.done&&(f=g.return)&&f.call(g)}finally{if(l)throw l.error}}try{for(var S=U(y),k=S.next();!k.done;k=S.next()){var T=k.value;(!De(e,T)||De(n.exitSet,T.parent))&&n.exitSet.push(T)}}catch(x){u={error:x}}finally{try{k&&!k.done&&(h=S.return)&&h.call(S)}finally{if(u)throw u.error}}n.exitSet.sort(function(x,L){return L.order-x.order});var I=Array.from(v).sort(function(x,L){return x.order-L.order}),C=new Set(n.exitSet),B=z(I.map(function(x){var L=[];if(x.type!=="final")return L;var K=x.parent;if(!K.parent)return L;L.push(qe(x.id,x.doneData),qe(K.id,x.doneData?ot(x.doneData,i,s):void 0));var a=K.parent;return a.type==="parallel"&&Le(a).every(function(p){return et(n.configuration,p)})&&L.push(qe(a.id)),L})),P=I.map(function(x){var L=x.onEntry,K=x.activities.map(function(a){return Fn(a)});return{type:"entry",actions:ce(c?V(V([],M(L),!1),M(K),!1):V(V([],M(K),!1),M(L),!1),d.machine.options.actions)}}).concat({type:"state_done",actions:B.map(function(x){return Un(x)})}),N=Array.from(C).map(function(x){return{type:"exit",actions:ce(V(V([],M(x.onExit),!1),M(x.activities.map(function(L){return $n(L)})),!1),d.machine.options.actions)}}),D=N.concat({type:"transition",actions:ce(n.actions,this.machine.options.actions)}).concat(P);if(r){var q=ce(z(V([],M(e),!1).sort(function(x,L){return L.order-x.order}).map(function(x){return x.onExit})),this.machine.options.actions).filter(function(x){return!Nt(x)});return D.concat({type:"stop",actions:q})}return D},t.prototype.transition=function(e,r,n,i){e===void 0&&(e=this.initialState);var s=W(r),o;if(e instanceof ne)o=n===void 0?e:this.resolveState(ne.from(e,n));else{var c=F(e)?this.resolve(st(this.getResolvedPath(e))):this.resolve(e),l=n??this.machine.context;o=this.resolveState(ne.from(c,l))}if(this.strict&&!this.events.includes(s.name)&&!On(s.name))throw new Error("Machine '".concat(this.id,"' does not accept event '").concat(s.name,"'"));var f=this._transition(o.value,o,s)||{transitions:[],configuration:[],exitSet:[],source:o,actions:[]},u=Re([],this.getStateNodes(o.value)),h=f.configuration.length?Re(u,f.configuration):u;return f.configuration=V([],M(h),!1),this.resolveTransition(f,o,o.context,i,s)},t.prototype.resolveRaisedTransition=function(e,r,n,i){var s,o=e.actions;return e=this.transition(e,r,void 0,i),e._event=n,e.event=n.data,(s=e.actions).unshift.apply(s,V([],M(o),!1)),e},t.prototype.resolveTransition=function(e,r,n,i,s){var o,c,l,f,u=this;s===void 0&&(s=Se);var h=e.configuration,d=!r||e.transitions.length>0,y=d?e.configuration:r?r.configuration:[],v=et(y,this),g=d?Qn(this.machine,h):void 0,A=r?r.historyValue?r.historyValue:e.source?this.machine.historyValue(r.value):void 0:void 0,T=this.getActions(new Set(y),v,e,n,s,r,i),S=r?E({},r.activities):{};try{for(var k=U(T),I=k.next();!I.done;I=k.next()){var C=I.value;try{for(var B=(l=void 0,U(C.actions)),P=B.next();!P.done;P=B.next()){var N=P.value;N.type===xt?S[N.activity.id||N.activity.type]=N:N.type===$t&&(S[N.activity.id||N.activity.type]=!1)}}catch(ee){l={error:ee}}finally{try{P&&!P.done&&(f=B.return)&&f.call(B)}finally{if(l)throw l.error}}}}catch(ee){o={error:ee}}finally{try{I&&!I.done&&(c=k.return)&&c.call(k)}finally{if(o)throw o.error}}var D=M(at(this,r,n,s,T,i,this.machine.config.predictableActionArguments||this.machine.config.preserveActionOrder),2),q=D[0],x=D[1],L=M(Nn(q,Nt),2),K=L[0],a=L[1],p=q.filter(function(ee){var ye;return ee.type===xt&&((ye=ee.activity)===null||ye===void 0?void 0:ye.type)===At}),w=p.reduce(function(ee,ye){return ee[ye.activity.id]=zn(ye.activity,u.machine,x,s),ee},r?E({},r.children):{}),R=new ne({value:g||r.value,context:x,_event:s,_sessionid:r?r._sessionid:null,historyValue:g?A?_n(A,g):void 0:r?r.historyValue:void 0,history:!g||e.source?r:void 0,actions:g?a:[],activities:g?S:r?r.activities:{},events:[],configuration:y,transitions:e.transitions,children:w,done:v,tags:nr(y),machine:this}),_=n!==x;R.changed=s.name===Sr||_;var b=R.history;b&&delete b.history;var Z=!v&&(this._transient||h.some(function(ee){return ee._transient}));if(!d&&(!Z||s.name===Ge))return R;var G=R;if(!v)for(Z&&(G=this.resolveRaisedTransition(G,{type:gn},s,i));K.length;){var se=K.shift();G=this.resolveRaisedTransition(G,se._event,s,i)}var Kr=G.changed||(b?!!G.actions.length||_||typeof b.value!=typeof G.value||!Lr(G.value,b.value):void 0);return G.changed=Kr,G.history=b,G},t.prototype.getStateNode=function(e){if(we(e))return this.machine.getStateNodeById(e);if(!this.states)throw new Error("Unable to retrieve child state '".concat(e,"' from '").concat(this.id,"'; no child states exist."));var r=this.states[e];if(!r)throw new Error("Child state '".concat(e,"' does not exist on '").concat(this.id,"'"));return r},t.prototype.getStateNodeById=function(e){var r=we(e)?e.slice(Dt.length):e;if(r===this.id)return this;var n=this.machine.idMap[r];if(!n)throw new Error("Child state node '#".concat(r,"' does not exist on machine '").concat(this.id,"'"));return n},t.prototype.getStateNodeByPath=function(e){if(typeof e=="string"&&we(e))try{return this.getStateNodeById(e.slice(1))}catch{}for(var r=Ot(e,this.delimiter).slice(),n=this;r.length;){var i=r.shift();if(!i.length)break;n=n.getStateNode(i)}return n},t.prototype.resolve=function(e){var r,n=this;if(!e)return this.initialStateValue||ge;switch(this.type){case"parallel":return Ne(this.initialStateValue,function(s,o){return s?n.getStateNode(o).resolve(e[o]||s):ge});case"compound":if(F(e)){var i=this.getStateNode(e);return i.type==="parallel"||i.type==="compound"?(r={},r[e]=i.initialStateValue,r):e}return Object.keys(e).length?Ne(e,function(s,o){return s?n.getStateNode(o).resolve(s):ge}):this.initialStateValue||{};default:return e||ge}},t.prototype.getResolvedPath=function(e){if(we(e)){var r=this.machine.idMap[e.slice(Dt.length)];if(!r)throw new Error("Unable to find state node '".concat(e,"'"));return r.path}return Ot(e,this.delimiter)},Object.defineProperty(t.prototype,"initialStateValue",{get:function(){var e;if(this.__cache.initialStateValue)return this.__cache.initialStateValue;var r;if(this.type==="parallel")r=er(this.states,function(n){return n.initialStateValue||ge},function(n){return n.type!=="history"});else if(this.initial!==void 0){if(!this.states[this.initial])throw new Error("Initial state '".concat(this.initial,"' not found on '").concat(this.key,"'"));r=ct(this.states[this.initial])?this.initial:(e={},e[this.initial]=this.states[this.initial].initialStateValue,e)}else r={};return this.__cache.initialStateValue=r,this.__cache.initialStateValue},enumerable:!1,configurable:!0}),t.prototype.getInitialState=function(e,r){this._init();var n=this.getStateNodes(e);return this.resolveTransition({configuration:n,exitSet:[],transitions:[],source:void 0,actions:[]},void 0,r??this.machine.context,void 0)},Object.defineProperty(t.prototype,"initialState",{get:function(){var e=this.initialStateValue;if(!e)throw new Error("Cannot retrieve initial state from simple state '".concat(this.id,"'."));return this.getInitialState(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"target",{get:function(){var e;if(this.type==="history"){var r=this.config;F(r.target)?e=we(r.target)?st(this.machine.getStateNodeById(r.target).path.slice(this.path.length-1)):r.target:e=r.target}return e},enumerable:!1,configurable:!0}),t.prototype.getRelativeStateNodes=function(e,r,n){return n===void 0&&(n=!0),n?e.type==="history"?e.resolveHistory(r):e.initialStateNodes:[e]},Object.defineProperty(t.prototype,"initialStateNodes",{get:function(){var e=this;if(ct(this))return[this];if(this.type==="compound"&&!this.initial)return[this];var r=We(this.initialStateValue);return z(r.map(function(n){return e.getFromRelativePath(n)}))},enumerable:!1,configurable:!0}),t.prototype.getFromRelativePath=function(e){if(!e.length)return[this];var r=M(e),n=r[0],i=r.slice(1);if(!this.states)throw new Error("Cannot retrieve subPath '".concat(n,"' from node with no states"));var s=this.getStateNode(n);if(s.type==="history")return s.resolveHistory();if(!this.states[n])throw new Error("Child state '".concat(n,"' does not exist on '").concat(this.id,"'"));return this.states[n].getFromRelativePath(i)},t.prototype.historyValue=function(e){if(Object.keys(this.states).length)return{current:e||this.initialStateValue,states:er(this.states,function(r,n){if(!e)return r.historyValue();var i=F(e)?void 0:e[n];return r.historyValue(i||r.initialStateValue)},function(r){return!r.history})}},t.prototype.resolveHistory=function(e){var r=this;if(this.type!=="history")return[this];var n=this.parent;if(!e){var i=this.target;return i?z(We(i).map(function(o){return n.getFromRelativePath(o)})):n.initialStateNodes}var s=kn(n.path,"states")(e).current;return F(s)?[n.getStateNode(s)]:z(We(s).map(function(o){return r.history==="deep"?n.getFromRelativePath(o):[n.states[o[0]]]}))},Object.defineProperty(t.prototype,"stateIds",{get:function(){var e=this,r=z(Object.keys(this.states).map(function(n){return e.states[n].stateIds}));return[this.id].concat(r)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"events",{get:function(){var e,r,n,i;if(this.__cache.events)return this.__cache.events;var s=this.states,o=new Set(this.ownEvents);if(s)try{for(var c=U(Object.keys(s)),l=c.next();!l.done;l=c.next()){var f=l.value,u=s[f];if(u.states)try{for(var h=(n=void 0,U(u.events)),d=h.next();!d.done;d=h.next()){var y=d.value;o.add("".concat(y))}}catch(v){n={error:v}}finally{try{d&&!d.done&&(i=h.return)&&i.call(h)}finally{if(n)throw n.error}}}}catch(v){e={error:v}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(e)throw e.error}}return this.__cache.events=Array.from(o)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ownEvents",{get:function(){var e=new Set(this.transitions.filter(function(r){return!(!r.target&&!r.actions.length&&r.internal)}).map(function(r){return r.eventType}));return Array.from(e)},enumerable:!1,configurable:!0}),t.prototype.resolveTarget=function(e){var r=this;if(e!==void 0)return e.map(function(n){if(!F(n))return n;var i=n[0]===r.delimiter;if(i&&!r.parent)return r.getStateNodeByPath(n.slice(1));var s=i?r.key+n:n;if(r.parent)try{var o=r.parent.getStateNodeByPath(s);return o}catch(c){throw new Error("Invalid transition definition for state node '".concat(r.id,`':
`).concat(c.message))}else return r.getStateNodeByPath(s)})},t.prototype.formatTransition=function(e){var r=this,n=Cn(e.target),i="internal"in e?e.internal:n?n.some(function(l){return F(l)&&l[0]===r.delimiter}):!0,s=this.machine.options.guards,o=this.resolveTarget(n),c=E(E({},e),{actions:ce(te(e.actions)),cond:Or(e.cond,s),target:o,source:this,internal:i,eventType:e.event,toJSON:function(){return E(E({},c),{target:c.target?c.target.map(function(l){return"#".concat(l.id)}):void 0,source:"#".concat(r.id)})}});return c},t.prototype.formatTransitions=function(){var e,r,n=this,i;if(!this.config.on)i=[];else if(Array.isArray(this.config.on))i=this.config.on;else{var s=this.config.on,o=wt,c=s[o],l=c===void 0?[]:c,f=Ft(s,[typeof o=="symbol"?o:o+""]);i=z(Object.keys(f).map(function(S){var k=me(S,f[S]);return k}).concat(me(wt,l)))}var u=this.config.always?me("",this.config.always):[],h=this.config.onDone?me(String(qe(this.id)),this.config.onDone):[],d=z(this.invoke.map(function(S){var k=[];return S.onDone&&k.push.apply(k,V([],M(me(String(Ze(S.id)),S.onDone)),!1)),S.onError&&k.push.apply(k,V([],M(me(String(_e(S.id)),S.onError)),!1)),k})),y=this.after,v=z(V(V(V(V([],M(h),!1),M(d),!1),M(i),!1),M(u),!1).map(function(S){return te(S).map(function(k){return n.formatTransition(k)})}));try{for(var g=U(y),A=g.next();!A.done;A=g.next()){var T=A.value;v.push(T)}}catch(S){e={error:S}}finally{try{A&&!A.done&&(r=g.return)&&r.call(g)}finally{if(e)throw e.error}}return v},t}(),sr=!1;function je(t,e){return!Pe&&!("predictableActionArguments"in t)&&!sr&&(sr=!0,console.warn("It is highly recommended to set `predictableActionArguments` to `true` when using `createMachine`. https://xstate.js.org/docs/guides/actions.html")),new li(t,e)}var Y=qn,re=_r;/*! js-cookie v3.0.1 | MIT */function ze(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)t[n]=r[n]}return t}var hi={read:function(t){return t[0]==='"'&&(t=t.slice(1,-1)),t.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(t){return encodeURIComponent(t).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function Ct(t,e){function r(i,s,o){if(!(typeof document>"u")){o=ze({},e,o),typeof o.expires=="number"&&(o.expires=new Date(Date.now()+o.expires*864e5)),o.expires&&(o.expires=o.expires.toUTCString()),i=encodeURIComponent(i).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var c="";for(var l in o)o[l]&&(c+="; "+l,o[l]!==!0&&(c+="="+o[l].split(";")[0]));return document.cookie=i+"="+t.write(s,i)+c}}function n(i){if(!(typeof document>"u"||arguments.length&&!i)){for(var s=document.cookie?document.cookie.split("; "):[],o={},c=0;c<s.length;c++){var l=s[c].split("="),f=l.slice(1).join("=");try{var u=decodeURIComponent(l[0]);if(o[u]=t.read(f,u),i===u)break}catch{}}return i?o[i]:o}}return Object.create({set:r,get:n,remove:function(i,s){r(i,"",ze({},s,{expires:-1}))},withAttributes:function(i){return Ct(this.converter,ze({},this.attributes,i))},withConverter:function(i){return Ct(ze({},this.converter,i),this.attributes)}},{attributes:{value:Object.freeze(e)},converter:{value:Object.freeze(t)}})}var Pt=Ct(hi,{path:"/"}),di=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function fi(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ut={},pi={get exports(){return ut},set exports(t){ut=t}};(function(t,e){var r=typeof self<"u"?self:di,n=function(){function s(){this.fetch=!1,this.DOMException=r.DOMException}return s.prototype=r,new s}();(function(s){(function(o){var c={searchParams:"URLSearchParams"in s,iterable:"Symbol"in s&&"iterator"in Symbol,blob:"FileReader"in s&&"Blob"in s&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in s,arrayBuffer:"ArrayBuffer"in s};function l(a){return a&&DataView.prototype.isPrototypeOf(a)}if(c.arrayBuffer)var f=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],u=ArrayBuffer.isView||function(a){return a&&f.indexOf(Object.prototype.toString.call(a))>-1};function h(a){if(typeof a!="string"&&(a=String(a)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(a))throw new TypeError("Invalid character in header field name");return a.toLowerCase()}function d(a){return typeof a!="string"&&(a=String(a)),a}function y(a){var p={next:function(){var w=a.shift();return{done:w===void 0,value:w}}};return c.iterable&&(p[Symbol.iterator]=function(){return p}),p}function v(a){this.map={},a instanceof v?a.forEach(function(p,w){this.append(w,p)},this):Array.isArray(a)?a.forEach(function(p){this.append(p[0],p[1])},this):a&&Object.getOwnPropertyNames(a).forEach(function(p){this.append(p,a[p])},this)}v.prototype.append=function(a,p){a=h(a),p=d(p);var w=this.map[a];this.map[a]=w?w+", "+p:p},v.prototype.delete=function(a){delete this.map[h(a)]},v.prototype.get=function(a){return a=h(a),this.has(a)?this.map[a]:null},v.prototype.has=function(a){return this.map.hasOwnProperty(h(a))},v.prototype.set=function(a,p){this.map[h(a)]=d(p)},v.prototype.forEach=function(a,p){for(var w in this.map)this.map.hasOwnProperty(w)&&a.call(p,this.map[w],w,this)},v.prototype.keys=function(){var a=[];return this.forEach(function(p,w){a.push(w)}),y(a)},v.prototype.values=function(){var a=[];return this.forEach(function(p){a.push(p)}),y(a)},v.prototype.entries=function(){var a=[];return this.forEach(function(p,w){a.push([w,p])}),y(a)},c.iterable&&(v.prototype[Symbol.iterator]=v.prototype.entries);function g(a){if(a.bodyUsed)return Promise.reject(new TypeError("Already read"));a.bodyUsed=!0}function A(a){return new Promise(function(p,w){a.onload=function(){p(a.result)},a.onerror=function(){w(a.error)}})}function T(a){var p=new FileReader,w=A(p);return p.readAsArrayBuffer(a),w}function S(a){var p=new FileReader,w=A(p);return p.readAsText(a),w}function k(a){for(var p=new Uint8Array(a),w=new Array(p.length),R=0;R<p.length;R++)w[R]=String.fromCharCode(p[R]);return w.join("")}function I(a){if(a.slice)return a.slice(0);var p=new Uint8Array(a.byteLength);return p.set(new Uint8Array(a)),p.buffer}function C(){return this.bodyUsed=!1,this._initBody=function(a){this._bodyInit=a,a?typeof a=="string"?this._bodyText=a:c.blob&&Blob.prototype.isPrototypeOf(a)?this._bodyBlob=a:c.formData&&FormData.prototype.isPrototypeOf(a)?this._bodyFormData=a:c.searchParams&&URLSearchParams.prototype.isPrototypeOf(a)?this._bodyText=a.toString():c.arrayBuffer&&c.blob&&l(a)?(this._bodyArrayBuffer=I(a.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):c.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(a)||u(a))?this._bodyArrayBuffer=I(a):this._bodyText=a=Object.prototype.toString.call(a):this._bodyText="",this.headers.get("content-type")||(typeof a=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):c.searchParams&&URLSearchParams.prototype.isPrototypeOf(a)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},c.blob&&(this.blob=function(){var a=g(this);if(a)return a;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?g(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(T)}),this.text=function(){var a=g(this);if(a)return a;if(this._bodyBlob)return S(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(k(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},c.formData&&(this.formData=function(){return this.text().then(D)}),this.json=function(){return this.text().then(JSON.parse)},this}var B=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function P(a){var p=a.toUpperCase();return B.indexOf(p)>-1?p:a}function N(a,p){p=p||{};var w=p.body;if(a instanceof N){if(a.bodyUsed)throw new TypeError("Already read");this.url=a.url,this.credentials=a.credentials,p.headers||(this.headers=new v(a.headers)),this.method=a.method,this.mode=a.mode,this.signal=a.signal,!w&&a._bodyInit!=null&&(w=a._bodyInit,a.bodyUsed=!0)}else this.url=String(a);if(this.credentials=p.credentials||this.credentials||"same-origin",(p.headers||!this.headers)&&(this.headers=new v(p.headers)),this.method=P(p.method||this.method||"GET"),this.mode=p.mode||this.mode||null,this.signal=p.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&w)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(w)}N.prototype.clone=function(){return new N(this,{body:this._bodyInit})};function D(a){var p=new FormData;return a.trim().split("&").forEach(function(w){if(w){var R=w.split("="),_=R.shift().replace(/\+/g," "),b=R.join("=").replace(/\+/g," ");p.append(decodeURIComponent(_),decodeURIComponent(b))}}),p}function q(a){var p=new v,w=a.replace(/\r?\n[\t ]+/g," ");return w.split(/\r?\n/).forEach(function(R){var _=R.split(":"),b=_.shift().trim();if(b){var Z=_.join(":").trim();p.append(b,Z)}}),p}C.call(N.prototype);function x(a,p){p||(p={}),this.type="default",this.status=p.status===void 0?200:p.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in p?p.statusText:"OK",this.headers=new v(p.headers),this.url=p.url||"",this._initBody(a)}C.call(x.prototype),x.prototype.clone=function(){return new x(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new v(this.headers),url:this.url})},x.error=function(){var a=new x(null,{status:0,statusText:""});return a.type="error",a};var L=[301,302,303,307,308];x.redirect=function(a,p){if(L.indexOf(p)===-1)throw new RangeError("Invalid status code");return new x(null,{status:p,headers:{location:a}})},o.DOMException=s.DOMException;try{new o.DOMException}catch{o.DOMException=function(p,w){this.message=p,this.name=w;var R=Error(p);this.stack=R.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function K(a,p){return new Promise(function(w,R){var _=new N(a,p);if(_.signal&&_.signal.aborted)return R(new o.DOMException("Aborted","AbortError"));var b=new XMLHttpRequest;function Z(){b.abort()}b.onload=function(){var G={status:b.status,statusText:b.statusText,headers:q(b.getAllResponseHeaders()||"")};G.url="responseURL"in b?b.responseURL:G.headers.get("X-Request-URL");var se="response"in b?b.response:b.responseText;w(new x(se,G))},b.onerror=function(){R(new TypeError("Network request failed"))},b.ontimeout=function(){R(new TypeError("Network request failed"))},b.onabort=function(){R(new o.DOMException("Aborted","AbortError"))},b.open(_.method,_.url,!0),_.credentials==="include"?b.withCredentials=!0:_.credentials==="omit"&&(b.withCredentials=!1),"responseType"in b&&c.blob&&(b.responseType="blob"),_.headers.forEach(function(G,se){b.setRequestHeader(se,G)}),_.signal&&(_.signal.addEventListener("abort",Z),b.onreadystatechange=function(){b.readyState===4&&_.signal.removeEventListener("abort",Z)}),b.send(typeof _._bodyInit>"u"?null:_._bodyInit)})}return K.polyfill=!0,s.fetch||(s.fetch=K,s.Headers=v,s.Request=N,s.Response=x),o.Headers=v,o.Request=N,o.Response=x,o.fetch=K,Object.defineProperty(o,"__esModule",{value:!0}),o})({})})(n),n.fetch.ponyfill=!0,delete n.fetch.polyfill;var i=n;e=i.fetch,e.default=i.fetch,e.fetch=i.fetch,e.Headers=i.Headers,e.Request=i.Request,e.Response=i.Response,t.exports=e})(pi,ut);const zt=fi(ut),He="nhostRefreshToken",Ye="nhostRefreshTokenExpiresAt",vi=3,yi=300,or=5,Mr=0,jr=1,he=10,pt=20;class tt extends Error{constructor(e){super(e.message),Error.captureStackTrace(this,this.constructor),e instanceof Error?(this.name=e.name,this.error={error:e.name,status:jr,message:e.message}):(this.name=e.error,this.error=e)}}const ue={status:he,error:"invalid-email",message:"Email is incorrectly formatted"},Ut={status:he,error:"invalid-password",message:"Password is incorrectly formatted"},ar={status:he,error:"invalid-phone-number",message:"Phone number is incorrectly formatted"},mi={status:he,error:"invalid-mfa-ticket",message:"MFA ticket is invalid"},gi={status:he,error:"no-mfa-ticket",message:"No MFA ticket has been provided"},wi={status:he,error:"no-refresh-token",message:"No refresh token has been provided"},Ei={status:pt,error:"refresher-already-running",message:"The token refresher is already running. You must wait until is has finished before submitting a new token."},oe={status:pt,error:"already-signed-in",message:"User is already signed in"},Ti={status:pt,error:"unauthenticated-user",message:"User is not authenticated"},Si={status:pt,error:"unverified-user",message:"Email needs verification"},bi={status:he,error:"invalid-refresh-token",message:"Invalid or expired refresh token"},xi={status:jr,error:"invalid-sign-in-method",message:"Invalid sign-in method"},Et={user:null,mfa:null,accessToken:{value:null,expiresAt:null},refreshTimer:{startedAt:null,attempts:0,lastAttempt:null},refreshToken:{value:null},importTokenAttempts:0,errors:{}};function Ai(t){return new TextEncoder().encode(t)}function fe(t){const e=new Uint8Array(t);let r="";for(const n of e)r+=String.fromCharCode(n);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function Ht(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),r=(4-e.length%4)%4,n=e.padEnd(e.length+r,"="),i=atob(n),s=new ArrayBuffer(i.length),o=new Uint8Array(s);for(let c=0;c<i.length;c++)o[c]=i.charCodeAt(c);return s}function Br(){return(window==null?void 0:window.PublicKeyCredential)!==void 0&&typeof window.PublicKeyCredential=="function"}function Fr(t){const{id:e}=t;return{...t,id:Ht(e),transports:t.transports}}function $r(t){return t==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(t)}class X extends Error{constructor(e,r="WebAuthnError"){super(e),this.name=r}}function ki({error:t,options:e}){var r,n;const{publicKey:i}=e;if(!i)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal===new AbortController().signal)return new X("Registration ceremony was sent an abort signal","AbortError")}else if(t.name==="ConstraintError"){if(((r=i.authenticatorSelection)===null||r===void 0?void 0:r.requireResidentKey)===!0)return new X("Discoverable credentials were required but no available authenticator supported it","ConstraintError");if(((n=i.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new X("User verification was required but no available authenticator supported it","ConstraintError")}else{if(t.name==="InvalidStateError")return new X("The authenticator was previously registered","InvalidStateError");if(t.name==="NotAllowedError")return new X("User clicked cancel, or the registration ceremony timed out","NotAllowedError");if(t.name==="NotSupportedError")return i.pubKeyCredParams.filter(s=>s.type==="public-key").length===0?new X('No entry in pubKeyCredParams was of type "public-key"',"NotSupportedError"):new X("No available authenticator supported any of the specified pubKeyCredParams algorithms","NotSupportedError");if(t.name==="SecurityError"){const s=window.location.hostname;if($r(s)){if(i.rp.id!==s)return new X(`The RP ID "${i.rp.id}" is invalid for this domain`,"SecurityError")}else return new X(`${window.location.hostname} is an invalid domain`,"SecurityError")}else if(t.name==="TypeError"){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new X("User ID was not between 1 and 64 characters","TypeError")}else if(t.name==="UnknownError")return new X("The authenticator was unable to process the specified options, or could not create a new credential","UnknownError")}return t}class Oi{createNewAbortSignal(){return this.controller&&this.controller.abort(),this.controller=new AbortController,this.controller.signal}reset(){this.controller=void 0}}const lt=new Oi;async function Vr(t){if(!Br())throw new Error("WebAuthn is not supported in this browser");const e={publicKey:{...t,challenge:Ht(t.challenge),user:{...t.user,id:Ai(t.user.id)},excludeCredentials:t.excludeCredentials.map(Fr)}};e.signal=lt.createNewAbortSignal();let r;try{r=await navigator.credentials.create(e)}catch(l){throw ki({error:l,options:e})}finally{lt.reset()}if(!r)throw new Error("Registration was not completed");const{id:n,rawId:i,response:s,type:o}=r,c={id:n,rawId:fe(i),response:{attestationObject:fe(s.attestationObject),clientDataJSON:fe(s.clientDataJSON)},type:o,clientExtensionResults:r.getClientExtensionResults(),authenticatorAttachment:r.authenticatorAttachment};return typeof s.getTransports=="function"&&(c.transports=s.getTransports()),c}function Ii(t){return new TextDecoder("utf-8").decode(t)}async function Ni(){if(navigator.credentials.conditionalMediationSupported)return!0;const t=window.PublicKeyCredential;return t.isConditionalMediationAvailable!==void 0&&t.isConditionalMediationAvailable()}function _i({error:t,options:e}){var r;const{publicKey:n}=e;if(!n)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal===new AbortController().signal)return new X("Authentication ceremony was sent an abort signal","AbortError")}else{if(t.name==="NotAllowedError")return!((r=n.allowCredentials)===null||r===void 0)&&r.length?new X("No available authenticator recognized any of the allowed credentials","NotAllowedError"):new X("User clicked cancel, or the authentication ceremony timed out","NotAllowedError");if(t.name==="SecurityError"){const i=window.location.hostname;if($r(i)){if(n.rpId!==i)return new X(`The RP ID "${n.rpId}" is invalid for this domain`,"SecurityError")}else return new X(`${window.location.hostname} is an invalid domain`,"SecurityError")}else if(t.name==="UnknownError")return new X("The authenticator was unable to process the specified options, or could not create a new assertion signature","UnknownError")}return t}async function Ri(t,e=!1){var r,n;if(!Br())throw new Error("WebAuthn is not supported in this browser");let i;((r=t.allowCredentials)===null||r===void 0?void 0:r.length)!==0&&(i=(n=t.allowCredentials)===null||n===void 0?void 0:n.map(Fr));const s={...t,challenge:Ht(t.challenge),allowCredentials:i},o={};if(e){if(!await Ni())throw Error("Browser does not support WebAuthn autofill");if(document.querySelectorAll("input[autocomplete*='webauthn']").length<1)throw Error('No <input> with `"webauthn"` in its `autocomplete` attribute was detected');o.mediation="conditional",s.allowCredentials=[]}o.publicKey=s,o.signal=lt.createNewAbortSignal();let c;try{c=await navigator.credentials.get(o)}catch(y){throw _i({error:y,options:o})}finally{lt.reset()}if(!c)throw new Error("Authentication was not completed");const{id:l,rawId:f,response:u,type:h}=c;let d;return u.userHandle&&(d=Ii(u.userHandle)),{id:l,rawId:fe(f),response:{authenticatorData:fe(u.authenticatorData),clientDataJSON:fe(u.clientDataJSON),signature:fe(u.signature),userHandle:d},type:h,clientExtensionResults:c.getClientExtensionResults(),authenticatorAttachment:c.authenticatorAttachment}}const vt=typeof window<"u",rt=new Map,Di=t=>vt&&typeof localStorage<"u"?localStorage.getItem(t):rt.get(t)??null,Ci=(t,e)=>{vt&&typeof localStorage<"u"?e?localStorage.setItem(t,e):localStorage.removeItem(t):e?rt.set(t,e):rt.has(t)&&rt.delete(t)},Pi=(t,e)=>{if(t==="localStorage"||t==="web")return Di;if(t==="cookie")return r=>vt?Pt.get(r)??null:null;if(!e)throw Error(`clientStorageType is set to '${t}' but no clientStorage has been given`);if(t==="react-native")return r=>{var n;return(n=e.getItem)==null?void 0:n.call(e,r)};if(t==="capacitor")return r=>{var n;return(n=e.get)==null?void 0:n.call(e,{key:r})};if(t==="expo-secure-storage")return r=>{var n;return(n=e.getItemAsync)==null?void 0:n.call(e,r)};if(t==="custom"){if(e.getItem&&e.removeItem)return e.getItem;if(e.getItemAsync)return e.getItemAsync;throw Error(`clientStorageType is set to 'custom' but clientStorage is missing either "getItem" and "removeItem" properties or "getItemAsync" property`)}throw Error(`Unknown storage type: ${t}`)},Ui=(t,e)=>{if(t==="localStorage"||t==="web")return Ci;if(t==="cookie")return(r,n)=>{vt&&(n?Pt.set(r,n,{expires:30,sameSite:"lax",httpOnly:!1}):Pt.remove(r))};if(!e)throw Error(`clientStorageType is set to '${t}' but no clienStorage has been given`);if(t==="react-native")return(r,n)=>{var i,s;return n?(i=e.setItem)==null?void 0:i.call(e,r,n):(s=e.removeItem)==null?void 0:s.call(e,r)};if(t==="capacitor")return(r,n)=>{var i,s;return n?(i=e.set)==null?void 0:i.call(e,{key:r,value:n}):(s=e.remove)==null?void 0:s.call(e,{key:r})};if(t==="expo-secure-storage")return async(r,n)=>{var i,s;return n?(i=e.setItemAsync)==null?void 0:i.call(e,r,n):(s=e.deleteItemAsync)==null?void 0:s.call(e,r)};if(t==="custom"){if(!e.removeItem)throw Error("clientStorageType is set to 'custom' but clientStorage is missing a removeItem property");if(e.setItem)return(r,n)=>{var i,s;return n?(i=e.setItem)==null?void 0:i.call(e,r,n):(s=e.removeItem)==null?void 0:s.call(e,r)};if(e.setItemAsync)return async(r,n)=>{var i,s;return n?(i=e.setItemAsync)==null?void 0:i.call(e,r,n):(s=e.removeItem)==null?void 0:s.call(e,r)};throw Error("clientStorageType is set to 'custom' but clientStorage is missing setItem or setItemAsync property")}throw Error(`Unknown storage type: ${t}`)},Je=t=>!t||!t.accessToken.value||!t.refreshToken.value||!t.accessToken.expiresAt||!t.user?null:{accessToken:t.accessToken.value,accessTokenExpiresIn:(t.accessToken.expiresAt.getTime()-Date.now())/1e3,refreshToken:t.refreshToken.value,user:t.user},de=({accessToken:t,isError:e,user:r,error:n})=>e?{session:null,error:n}:r&&t?{session:{accessToken:t,accessTokenExpiresIn:0,refreshToken:"",user:r},error:null}:{session:null,error:null},Li=()=>typeof window<"u",Mi=async(t,e,{token:r,body:n}={})=>{const i={"Content-Type":"application/json",Accept:"*/*"};r&&(i.Authorization=`Bearer ${r}`);const s={method:e,headers:i};n&&(s.body=JSON.stringify(n));try{const o=await zt(t,s);if(!o.ok){const c=await o.json();return Promise.reject({error:c})}try{return{data:await o.json(),error:null}}catch{return console.warn(`Unexpected response: can't parse the response of the server at ${t}`),{data:"OK",error:null}}}catch{const o={message:"Network Error",status:Mr,error:"network"};return Promise.reject({error:o})}},ve=async(t,e,r)=>Mi(t,"POST",{token:r,body:e}),qr=(t,e)=>{const r=e&&Object.entries(e).map(([n,i])=>{const s=Array.isArray(i)?i.join(","):typeof i=="object"?JSON.stringify(i):i;return`${n}=${encodeURIComponent(s)}`}).join("&");return r?`${t}?${r}`:t},ie=(t,e)=>{if(!(e!=null&&e.redirectTo))return e;const{redirectTo:r,...n}=e;if(!t)return r.startsWith("/")?n:e;const i=new URL(t),s=Object.fromEntries(new URLSearchParams(i.search)),o=new URL(r.startsWith("/")?i.origin+r:r),c=new URLSearchParams(o.search);let l=Object.fromEntries(c);r.startsWith("/")&&(l={...s,...l});let f=i.pathname;return o.pathname.length>1&&(f+=o.pathname.slice(1)),{...n,redirectTo:qr(o.origin+f,l)}};function Qe(t,e){var r;if(!e){if(typeof window>"u")return;e=((r=window.location)==null?void 0:r.href)||""}t=t.replace(/[\[\]]/g,"\\$&");const n=new RegExp("[?&#]"+t+"(=([^&#]*)|&|#|$)"),i=n.exec(e);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}function cr(t){var e;if(typeof window>"u")return;const r=window==null?void 0:window.location;if(r&&r){const n=new URLSearchParams(r.search),i=new URLSearchParams((e=r.hash)==null?void 0:e.slice(1));n.delete(t),i.delete(t);let s=window.location.pathname;Array.from(n).length&&(s+=`?${n.toString()}`),Array.from(i).length&&(s+=`#${i.toString()}`),window.history.pushState({},"",s)}}const le=t=>!!t&&typeof t=="string"&&!!String(t).toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/),Lt=t=>!!t&&typeof t=="string"&&t.length>=vi,ur=t=>!!t&&typeof t=="string",ji=t=>t&&typeof t=="string"&&t.match(/^mfaTotp:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i),Bi=({backendUrl:t,clientUrl:e,clientStorageType:r="web",clientStorage:n,refreshIntervalTime:i,autoRefreshToken:s=!0,autoSignIn:o=!0})=>{const c=Pi(r,n),l=Ui(r,n),f=async(u,h,d)=>(await ve(`${t}${u}`,h,d)).data;return je({schema:{context:{},events:{},services:{}},tsTypes:{},context:Et,predictableActionArguments:!0,id:"nhost",type:"parallel",states:{authentication:{initial:"starting",on:{SESSION_UPDATE:[{cond:"hasSession",actions:["saveSession","resetTimer","reportTokenChanged"],target:".signedIn"}]},states:{starting:{tags:["loading"],always:{cond:"isSignedIn",target:"signedIn"},invoke:{id:"importRefreshToken",src:"importRefreshToken",onDone:[{cond:"hasSession",actions:["saveSession","reportTokenChanged"],target:"signedIn"},{target:"signedOut"}],onError:[{cond:"shouldRetryImportToken",actions:"incrementTokenImportAttempts",target:"retryTokenImport"},{actions:["saveAuthenticationError"],target:"signedOut"}]}},retryTokenImport:{tags:["loading"],after:{RETRY_IMPORT_TOKEN_DELAY:"starting"}},signedOut:{initial:"noErrors",entry:"reportSignedOut",states:{noErrors:{},success:{},needsSmsOtp:{},needsMfa:{},failed:{},signingOut:{entry:["clearContextExceptRefreshToken"],exit:["destroyRefreshToken","reportTokenChanged"],invoke:{src:"signout",id:"signingOut",onDone:{target:"success"},onError:{target:"failed",actions:["saveAuthenticationError"]}}}},on:{SIGNIN_PASSWORD:"authenticating.password",SIGNIN_ANONYMOUS:"authenticating.anonymous",SIGNIN_SECURITY_KEY_EMAIL:"authenticating.securityKeyEmail",SIGNIN_MFA_TOTP:"authenticating.mfa.totp"}},authenticating:{entry:"resetErrors",states:{password:{invoke:{src:"signInPassword",id:"authenticateUserWithPassword",onDone:[{cond:"hasMfaTicket",actions:["saveMfaTicket"],target:"#nhost.authentication.signedOut.needsMfa"},{actions:["saveSession","reportTokenChanged"],target:"#nhost.authentication.signedIn"}],onError:[{cond:"unverified",target:["#nhost.authentication.signedOut","#nhost.registration.incomplete.needsEmailVerification"]},{actions:"saveAuthenticationError",target:"#nhost.authentication.signedOut.failed"}]}},anonymous:{invoke:{src:"signInAnonymous",id:"authenticateAnonymously",onDone:{actions:["saveSession","reportTokenChanged"],target:"#nhost.authentication.signedIn"},onError:{actions:"saveAuthenticationError",target:"#nhost.authentication.signedOut.failed"}}},mfa:{states:{totp:{invoke:{src:"signInMfaTotp",id:"signInMfaTotp",onDone:{actions:["saveSession","reportTokenChanged"],target:"#nhost.authentication.signedIn"},onError:{actions:["saveAuthenticationError"],target:"#nhost.authentication.signedOut.failed"}}}}},securityKeyEmail:{invoke:{src:"signInSecurityKeyEmail",id:"authenticateUserWithSecurityKey",onDone:{actions:["saveSession","reportTokenChanged"],target:"#nhost.authentication.signedIn"},onError:[{cond:"unverified",target:["#nhost.authentication.signedOut","#nhost.registration.incomplete.needsEmailVerification"]},{actions:"saveAuthenticationError",target:"#nhost.authentication.signedOut.failed"}]}}}},signedIn:{type:"parallel",entry:["reportSignedIn","cleanUrl","broadcastToken","resetErrors"],on:{SIGNOUT:"signedOut.signingOut"},states:{refreshTimer:{id:"timer",initial:"idle",states:{disabled:{type:"final"},stopped:{always:{cond:"noToken",target:"idle"}},idle:{always:[{cond:"isAutoRefreshDisabled",target:"disabled"},{cond:"hasRefreshToken",target:"running"}]},running:{initial:"pending",entry:"resetTimer",states:{pending:{after:{1e3:{internal:!1,target:"pending"}},always:{cond:"refreshTimerShouldRefresh",target:"refreshing"}},refreshing:{invoke:{src:"refreshToken",id:"refreshToken",onDone:{actions:["saveSession","resetTimer","reportTokenChanged"],target:"pending"},onError:[{actions:"saveRefreshAttempt",target:"pending"}]}}}}}}}}}},token:{initial:"idle",states:{idle:{on:{TRY_TOKEN:"running"},initial:"noErrors",states:{noErrors:{},error:{}}},running:{invoke:{src:"refreshToken",id:"authenticateWithToken",onDone:{actions:["saveSession","reportTokenChanged"],target:["#nhost.authentication.signedIn","idle.noErrors"]},onError:[{cond:"isSignedIn",target:"idle.error"},{actions:"saveAuthenticationError",target:["#nhost.authentication.signedOut.failed","idle.error"]}]}}}},registration:{initial:"incomplete",on:{SIGNED_IN:[{cond:"isAnonymous",target:".incomplete"},".complete"]},states:{incomplete:{on:{SIGNUP_EMAIL_PASSWORD:"emailPassword",SIGNUP_SECURITY_KEY:"securityKey",PASSWORDLESS_EMAIL:"passwordlessEmail",PASSWORDLESS_SMS:"passwordlessSms",PASSWORDLESS_SMS_OTP:"passwordlessSmsOtp"},initial:"noErrors",states:{noErrors:{},needsEmailVerification:{},needsOtp:{},failed:{}}},emailPassword:{entry:["resetErrors"],invoke:{src:"signUpEmailPassword",id:"signUpEmailPassword",onDone:[{cond:"hasSession",actions:["saveSession","reportTokenChanged"],target:"#nhost.authentication.signedIn"},{actions:"clearContext",target:["#nhost.authentication.signedOut","incomplete.needsEmailVerification"]}],onError:[{cond:"unverified",target:"incomplete.needsEmailVerification"},{actions:"saveRegistrationError",target:"incomplete.failed"}]}},securityKey:{entry:["resetErrors"],invoke:{src:"signUpSecurityKey",id:"signUpSecurityKey",onDone:[{cond:"hasSession",actions:["saveSession","reportTokenChanged"],target:"#nhost.authentication.signedIn"},{actions:"clearContext",target:["#nhost.authentication.signedOut","incomplete.needsEmailVerification"]}],onError:[{cond:"unverified",target:"incomplete.needsEmailVerification"},{actions:"saveRegistrationError",target:"incomplete.failed"}]}},passwordlessEmail:{entry:["resetErrors"],invoke:{src:"passwordlessEmail",id:"passwordlessEmail",onDone:{actions:"clearContext",target:["#nhost.authentication.signedOut","incomplete.needsEmailVerification"]},onError:{actions:"saveRegistrationError",target:"incomplete.failed"}}},passwordlessSms:{entry:["resetErrors"],invoke:{src:"passwordlessSms",id:"passwordlessSms",onDone:{actions:"clearContext",target:["#nhost.authentication.signedOut","incomplete.needsOtp"]},onError:{actions:"saveRegistrationError",target:"incomplete.failed"}}},passwordlessSmsOtp:{entry:["resetErrors"],invoke:{src:"passwordlessSmsOtp",id:"passwordlessSmsOtp",onDone:{actions:["saveSession","reportTokenChanged"],target:"#nhost.authentication.signedIn"},onError:{actions:"saveRegistrationError",target:"incomplete.failed"}}},complete:{on:{SIGNED_OUT:"incomplete"}}}}}},{actions:{reportSignedIn:re("SIGNED_IN"),reportSignedOut:re("SIGNED_OUT"),reportTokenChanged:re("TOKEN_CHANGED"),incrementTokenImportAttempts:Y({importTokenAttempts:({importTokenAttempts:u})=>u+1}),clearContext:Y(()=>(l(Ye,null),l(He,null),{...Et})),clearContextExceptRefreshToken:Y(({refreshToken:{value:u}})=>(l(Ye,null),{...Et,refreshToken:{value:u}})),saveSession:Y({user:(u,{data:h})=>{var d;return((d=h==null?void 0:h.session)==null?void 0:d.user)||null},accessToken:(u,{data:h})=>{if(h.session){const{accessTokenExpiresIn:d,accessToken:y}=h.session,v=new Date(Date.now()+d*1e3);return l(Ye,v.toISOString()),{value:y,expiresAt:v}}return l(Ye,null),{value:null,expiresAt:null}},refreshToken:(u,{data:h})=>{var d;const y=((d=h.session)==null?void 0:d.refreshToken)||null;return y&&l(He,y),{value:y}}}),saveMfaTicket:Y({mfa:(u,h)=>{var d;return(d=h.data)==null?void 0:d.mfa}}),resetTimer:Y({refreshTimer:u=>({startedAt:new Date,attempts:0,lastAttempt:null})}),saveRefreshAttempt:Y({refreshTimer:(u,h)=>({startedAt:u.refreshTimer.startedAt,attempts:u.refreshTimer.attempts+1,lastAttempt:new Date})}),saveAuthenticationError:Y({errors:({errors:u},{data:{error:h}})=>({...u,authentication:h})}),resetErrors:Y({errors:u=>({}),importTokenAttempts:u=>0}),saveRegistrationError:Y({errors:({errors:u},{data:{error:h}})=>({...u,registration:h})}),destroyRefreshToken:Y({refreshToken:u=>(l(He,null),{value:null})}),cleanUrl:()=>{o&&Qe("refreshToken")&&(cr("refreshToken"),cr("type"))},broadcastToken:u=>{if(o)try{new BroadcastChannel("nhost").postMessage(u.refreshToken.value)}catch{}}},guards:{isAnonymous:(u,h)=>{var d;return!!((d=u.user)!=null&&d.isAnonymous)},isSignedIn:u=>!!u.user&&!!u.refreshToken.value&&!!u.accessToken.value,noToken:u=>!u.refreshToken.value,hasRefreshToken:u=>!!u.refreshToken.value,isAutoRefreshDisabled:()=>!s,refreshTimerShouldRefresh:u=>{const{expiresAt:h}=u.accessToken;return h?u.refreshTimer.lastAttempt?u.refreshTimer.attempts>or?!1:Date.now()-u.refreshTimer.lastAttempt.getTime()>Math.pow(2,u.refreshTimer.attempts-1)*5e3:i&&Date.now()-u.refreshTimer.startedAt.getTime()>i*1e3?!0:h.getTime()-Date.now()-1e3*yi<=0:!1},shouldRetryImportToken:(u,h)=>u.importTokenAttempts<or&&(h.data.error.status===Mr||h.data.error.status>=500),unverified:(u,{data:{error:h}})=>h.status===401&&(h.message==="Email is not verified"||h.error==="unverified-user"),hasSession:(u,h)=>{var d;return!!((d=h.data)!=null&&d.session)},hasMfaTicket:(u,h)=>{var d;return!!((d=h.data)!=null&&d.mfa)}},services:{signInPassword:(u,{email:h,password:d})=>le(h)?Lt(d)?f("/signin/email-password",{email:h,password:d}):Promise.reject({error:Ut}):Promise.reject({error:ue}),passwordlessSms:(u,{phoneNumber:h,options:d})=>{var y;return ur(h)?(y=u.user)!=null&&y.isAnonymous?(console.warn("Deanonymisation from a phone number is not yet implemented in hasura-auth"),f("/user/deanonymize",{signInMethod:"passwordless",connection:"sms",phoneNumber:h,options:ie(e,d)},u.accessToken.value)):f("/signin/passwordless/sms",{phoneNumber:h,options:ie(e,d)}):Promise.reject({error:ar})},passwordlessSmsOtp:(u,{phoneNumber:h,otp:d})=>ur(h)?f("/signin/passwordless/sms/otp",{phoneNumber:h,otp:d}):Promise.reject({error:ar}),passwordlessEmail:(u,{email:h,options:d})=>{var y;return le(h)?(y=u.user)!=null&&y.isAnonymous?f("/user/deanonymize",{signInMethod:"passwordless",connection:"email",email:h,options:ie(e,d)},u.accessToken.value):f("/signin/passwordless/email",{email:h,options:ie(e,d)}):Promise.reject({error:ue})},signInAnonymous:u=>f("/signin/anonymous"),signInMfaTotp:(u,h)=>{var d;const y=h.ticket||((d=u.mfa)==null?void 0:d.ticket);return y?ji(y)?f("/signin/mfa/totp",{ticket:y,otp:h.otp}):Promise.reject({error:mi}):Promise.reject({error:gi})},signInSecurityKeyEmail:async(u,{email:h})=>{if(!le(h))throw new tt(ue);const d=await f("/signin/webauthn",{email:h});let y;try{y=await Ri(d)}catch(v){throw new tt(v)}return f("/signin/webauthn/verify",{email:h,credential:y})},refreshToken:async(u,h)=>{const d=h.type==="TRY_TOKEN"?h.token:u.refreshToken.value;return{session:await f("/token",{refreshToken:d}),error:null}},signout:(u,h)=>f("/signout",{refreshToken:u.refreshToken.value,all:!!h.all}),signUpEmailPassword:async(u,{email:h,password:d,options:y})=>{var v;return le(h)?Lt(d)?(v=u.user)!=null&&v.isAnonymous?f("/user/deanonymize",{signInMethod:"email-password",email:h,password:d,options:ie(e,y)},u.accessToken.value):f("/signup/email-password",{email:h,password:d,options:ie(e,y)}):Promise.reject({error:Ut}):Promise.reject({error:ue})},signUpSecurityKey:async(u,{email:h,options:d})=>{if(!le(h))return Promise.reject({error:ue});const y=d==null?void 0:d.nickname;y&&delete d.nickname;const v=await f("/signup/webauthn",{email:h,options:d});let g;try{g=await Vr(v)}catch(A){throw new tt(A)}return f("/signup/webauthn/verify",{credential:g,options:{redirectTo:d==null?void 0:d.redirectTo,nickname:y}})},importRefreshToken:async u=>{if(u.user&&u.refreshToken.value&&u.accessToken.value&&u.accessToken.expiresAt)return{session:{accessToken:u.accessToken.value,accessTokenExpiresIn:u.accessToken.expiresAt.getTime()-Date.now(),refreshToken:u.refreshToken.value,user:u.user},error:null};let h=null;if(o){const y=Qe("refreshToken")||null;if(y)try{return{session:await f("/token",{refreshToken:y}),error:null}}catch(v){h=v.error}else{const v=Qe("error");if(v)return Promise.reject({session:null,error:{status:he,error:v,message:Qe("errorDescription")||v}})}}const d=await c(He);if(d)try{return{session:await f("/token",{refreshToken:d}),error:null}}catch(y){h=y.error}return h?Promise.reject({error:h,session:null}):{error:null,session:null}}},delays:{RETRY_IMPORT_TOKEN_DELAY:({importTokenAttempts:u})=>Math.pow(2,u-1)*5e3}})},Fi=({backendUrl:t,clientUrl:e,interpreter:r})=>je({schema:{context:{},events:{},services:{}},tsTypes:{},predictableActionArguments:!0,id:"changeEmail",initial:"idle",context:{error:null},states:{idle:{on:{REQUEST:[{cond:"invalidEmail",actions:"saveInvalidEmailError",target:".error"},{target:"requesting"}]},initial:"initial",states:{initial:{},success:{},error:{}}},requesting:{invoke:{src:"requestChange",id:"requestChange",onDone:{target:"idle.success",actions:"reportSuccess"},onError:{actions:["saveRequestError","reportError"],target:"idle.error"}}}}},{actions:{saveInvalidEmailError:Y({error:n=>ue}),saveRequestError:Y({error:(n,{data:{error:i}})=>i}),reportError:re(n=>({type:"ERROR",error:n.error})),reportSuccess:re("SUCCESS")},guards:{invalidEmail:(n,{email:i})=>!le(i)},services:{requestChange:async(n,{email:i,options:s})=>(await ve(`${t}/user/email/change`,{newEmail:i,options:ie(e,s)},r==null?void 0:r.getSnapshot().context.accessToken.value)).data}}),$i=({backendUrl:t,interpreter:e})=>je({schema:{context:{},events:{},services:{}},tsTypes:{},predictableActionArguments:!0,id:"changePassword",initial:"idle",context:{error:null},states:{idle:{on:{REQUEST:[{cond:"invalidPassword",actions:"saveInvalidPasswordError",target:".error"},{target:"requesting"}]},initial:"initial",states:{initial:{},success:{},error:{}}},requesting:{invoke:{src:"requestChange",id:"requestChange",onDone:{target:"idle.success",actions:"reportSuccess"},onError:{actions:["saveRequestError","reportError"],target:"idle.error"}}}}},{actions:{saveInvalidPasswordError:Y({error:r=>Ut}),saveRequestError:Y({error:(r,{data:{error:n}})=>n}),reportError:re(r=>({type:"ERROR",error:r.error})),reportSuccess:re("SUCCESS")},guards:{invalidPassword:(r,{password:n})=>!Lt(n)},services:{requestChange:(r,{password:n,ticket:i})=>ve(`${t}/user/password`,{newPassword:n,ticket:i},e==null?void 0:e.getSnapshot().context.accessToken.value)}}),Vi=({backendUrl:t,clientUrl:e})=>je({schema:{context:{},events:{},services:{}},tsTypes:{},predictableActionArguments:!0,id:"changePassword",initial:"idle",context:{error:null},states:{idle:{on:{REQUEST:[{cond:"invalidEmail",actions:"saveInvalidEmailError",target:".error"},{target:"requesting"}]},initial:"initial",states:{initial:{},success:{},error:{}}},requesting:{invoke:{src:"requestChange",id:"requestChange",onDone:{target:"idle.success",actions:"reportSuccess"},onError:{actions:["saveRequestError","reportError"],target:"idle.error"}}}}},{actions:{saveInvalidEmailError:Y({error:r=>ue}),saveRequestError:Y({error:(r,{data:{error:n}})=>n}),reportError:re(r=>({type:"ERROR",error:r.error})),reportSuccess:re("SUCCESS")},guards:{invalidEmail:(r,{email:n})=>!le(n)},services:{requestChange:(r,{email:n,options:i})=>ve(`${t}/user/password/reset`,{email:n,options:ie(e,i)})}}),qi=({backendUrl:t,clientUrl:e})=>je({schema:{context:{},events:{},services:{}},tsTypes:{},predictableActionArguments:!0,id:"sendVerificationEmail",initial:"idle",context:{error:null},states:{idle:{on:{REQUEST:[{cond:"invalidEmail",actions:"saveInvalidEmailError",target:".error"},{target:"requesting"}]},initial:"initial",states:{initial:{},success:{},error:{}}},requesting:{invoke:{src:"request",id:"request",onDone:{target:"idle.success",actions:"reportSuccess"},onError:{actions:["saveRequestError","reportError"],target:"idle.error"}}}}},{actions:{saveInvalidEmailError:Y({error:r=>ue}),saveRequestError:Y({error:(r,{data:{error:n}})=>n}),reportError:re(r=>({type:"ERROR",error:r.error})),reportSuccess:re("SUCCESS")},guards:{invalidEmail:(r,{email:n})=>!le(n)},services:{request:async(r,{email:n,options:i})=>(await ve(`${t}/user/email/send-verification-email`,{email:n,options:ie(e,i)})).data}});class Ki{constructor({clientStorageType:e="web",autoSignIn:r=!0,autoRefreshToken:n=!0,start:i=!0,backendUrl:s,clientUrl:o,devTools:c,...l}){if(this._started=!1,this._subscriptionsQueue=new Set,this._subscriptions=new Set,this.backendUrl=s,this.clientUrl=o,this._machine=Bi({...l,backendUrl:s,clientUrl:o,clientStorageType:e,autoSignIn:r,autoRefreshToken:n}),i&&this.start({devTools:c}),typeof window<"u"&&r)try{this._channel=new BroadcastChannel("nhost"),this._channel.addEventListener("message",f=>{var u;const h=(u=this.interpreter)==null?void 0:u.getSnapshot().context.refreshToken.value;this.interpreter&&f.data!==h&&this.interpreter.send("TRY_TOKEN",{token:f.data})})}catch{}}start({devTools:e=!1,initialSession:r,interpreter:n}={}){const i={...this.machine.context};r&&(i.user=r.user,i.refreshToken.value=r.refreshToken??null,i.accessToken.value=r.accessToken??null,i.accessToken.expiresAt=new Date(Date.now()+r.accessTokenExpiresIn*1e3));const s=this.machine.withContext(i);this._interpreter||(this._interpreter=n||Te(s,{devTools:e})),(!this._started||typeof window>"u")&&(this._interpreter.initialized&&(this._interpreter.stop(),this._subscriptions.forEach(o=>o())),this._interpreter.start(s.initialState),this._subscriptionsQueue.forEach(o=>o(this))),this._started=!0}get machine(){return this._machine}get interpreter(){return this._interpreter}get started(){return this._started}subscribe(e){if(this.started){const r=e(this);return this._subscriptions.add(r),r}else return this._subscriptionsQueue.add(e),()=>{console.log("onTokenChanged was added before the interpreter started. Cannot unsubscribe listener.")}}}const Gi=async({backendUrl:t,interpreter:e},r)=>{try{const{data:n}=await ve("/user/webauthn/add",{},e==null?void 0:e.getSnapshot().context.accessToken.value);let i;try{i=await Vr(n)}catch(o){throw new tt(o)}const{data:s}=await ve(`${t}/user/webauthn/verify`,{credential:i,nickname:r},e==null?void 0:e.getSnapshot().context.accessToken.value);return{key:s,isError:!1,error:null,isSuccess:!0}}catch(n){const{error:i}=n;return{isError:!0,error:i,isSuccess:!1}}},zi=async(t,e,r)=>new Promise(n=>{t.send("REQUEST",{email:e,options:r}),t.onTransition(i=>{i.matches({idle:"error"})?n({error:i.context.error,isError:!0,needsEmailVerification:!1}):i.matches({idle:"success"})&&n({error:null,isError:!1,needsEmailVerification:!0})})}),Hi=async(t,e,r)=>new Promise(n=>{t.send("REQUEST",{password:e,ticket:r}),t.onTransition(i=>{i.matches({idle:"error"})?n({error:i.context.error,isError:!0,isSuccess:!1}):i.matches({idle:"success"})&&n({error:null,isError:!1,isSuccess:!0})})}),Yi=async(t,e,r)=>new Promise(n=>{t.send("REQUEST",{email:e,options:r}),t.onTransition(i=>{i.matches({idle:"error"})?n({error:i.context.error,isError:!0,isSent:!1}):i.matches({idle:"success"})&&n({error:null,isError:!1,isSent:!0})})}),Ji=(t,e,r)=>new Promise(n=>{t.send("REQUEST",{email:e,options:r}),t.onTransition(i=>{i.matches({idle:"error"})?n({error:i.context.error,isError:!0,isSent:!1}):i.matches({idle:"success"})&&n({error:null,isError:!1,isSent:!0})})}),Qi=t=>new Promise(e=>{const{changed:r}=t.send("SIGNIN_ANONYMOUS");r||e({isSuccess:!1,isError:!0,error:oe,user:null,accessToken:null}),t.onTransition(n=>{n.matches({authentication:"signedIn"})&&e({isSuccess:!0,isError:!1,error:null,user:n.context.user,accessToken:n.context.accessToken.value}),n.matches({authentication:{signedOut:"failed"}})&&e({isSuccess:!1,isError:!0,error:n.context.errors.authentication||null,user:null,accessToken:null})})}),Wi=(t,e,r)=>new Promise(n=>{const{changed:i,context:s}=t.send("SIGNIN_PASSWORD",{email:e,password:r});if(!i)return n({accessToken:s.accessToken.value,error:oe,isError:!0,isSuccess:!1,needsEmailVerification:!1,needsMfaOtp:!1,mfa:null,user:s.user});t.onTransition(o=>{o.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}})?n({accessToken:null,error:null,isError:!1,isSuccess:!1,needsEmailVerification:!0,needsMfaOtp:!1,mfa:null,user:null}):o.matches({authentication:{signedOut:"needsMfa"}})?n({accessToken:null,error:null,isError:!1,isSuccess:!1,needsEmailVerification:!1,needsMfaOtp:!0,mfa:o.context.mfa,user:null}):o.matches({authentication:{signedOut:"failed"}})?n({accessToken:null,error:o.context.errors.authentication||null,isError:!0,isSuccess:!1,needsEmailVerification:!1,needsMfaOtp:!1,mfa:null,user:null}):o.matches({authentication:"signedIn"})&&n({accessToken:o.context.accessToken.value,error:null,isError:!1,isSuccess:!0,needsEmailVerification:!1,needsMfaOtp:!1,mfa:null,user:o.context.user})})}),lr=(t,e,r)=>new Promise(n=>{const{changed:i}=t.send("PASSWORDLESS_EMAIL",{email:e,options:r});if(!i)return n({error:oe,isError:!0,isSuccess:!1});t.onTransition(s=>{s.matches("registration.incomplete.failed")?n({error:s.context.errors.registration||null,isError:!0,isSuccess:!1}):s.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}})&&n({error:null,isError:!1,isSuccess:!0})})}),Xi=(t,e)=>new Promise(r=>{const{changed:n,context:i}=t.send({type:"SIGNIN_SECURITY_KEY_EMAIL",email:e});if(!n)return r({accessToken:i.accessToken.value,error:oe,isError:!0,isSuccess:!1,needsEmailVerification:!1,user:i.user});t.onTransition(s=>{s.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}})?r({accessToken:null,error:null,isError:!1,isSuccess:!1,needsEmailVerification:!0,user:null}):s.matches({authentication:{signedOut:"failed"}})?r({accessToken:null,error:s.context.errors.authentication||null,isError:!0,isSuccess:!1,needsEmailVerification:!1,user:null}):s.matches({authentication:"signedIn"})&&r({accessToken:s.context.accessToken.value,error:null,isError:!1,isSuccess:!0,needsEmailVerification:!1,user:s.context.user})})}),Zi=(t,e,r)=>new Promise(n=>{const{changed:i,context:s}=t.send("SIGNIN_MFA_TOTP",{otp:e,ticket:r});if(!i)return n({accessToken:s.accessToken.value,error:oe,isError:!0,isSuccess:!1,user:s.user});t.onTransition(o=>{o.matches({authentication:{signedOut:"failed"}})?n({accessToken:null,error:o.context.errors.authentication||null,isError:!0,isSuccess:!1,user:null}):o.matches({authentication:"signedIn"})&&n({accessToken:o.context.accessToken.value,error:null,isError:!1,isSuccess:!0,user:o.context.user})})}),hr=(t,e,r)=>new Promise(n=>{const{changed:i}=t.send("PASSWORDLESS_SMS",{phoneNumber:e,options:r});if(!i)return n({error:oe,isError:!0,isSuccess:!1,needsOtp:!1});t.onTransition(s=>{s.matches("registration.incomplete.needsOtp")?n({error:null,isError:!1,isSuccess:!1,needsOtp:!0}):s.matches("registration.incomplete.failed")&&n({error:s.context.errors.authentication||null,isError:!0,isSuccess:!1,needsOtp:!1})})}),es=(t,e,r)=>new Promise(n=>{const{changed:i}=t.send({type:"PASSWORDLESS_SMS_OTP",phoneNumber:e,otp:r});if(!i)return n({error:oe,isError:!0,isSuccess:!1,user:null,accessToken:null});t.onTransition(s=>{s.matches({authentication:"signedIn"})?n({error:null,isError:!1,isSuccess:!0,user:s.context.user,accessToken:s.context.accessToken.value}):s.matches({registration:{incomplete:"failed"}})&&n({error:s.context.errors.authentication||null,isError:!0,isSuccess:!1,user:null,accessToken:null})})}),ts=async(t,e)=>new Promise(r=>{const{event:n}=t.send("SIGNOUT",{all:e});if(n.type!=="SIGNED_OUT")return r({isSuccess:!1,isError:!0,error:Ti});t.onTransition(i=>{i.matches({authentication:{signedOut:"success"}})?r({isSuccess:!0,isError:!1,error:null}):i.matches("authentication.signedOut.failed")&&r({isSuccess:!1,isError:!0,error:i.context.errors.signout||null})})}),dr=(t,e,r,n)=>new Promise(i=>{const{changed:s,context:o}=t.send("SIGNUP_EMAIL_PASSWORD",{email:e,password:r,options:n});if(!s)return i({error:oe,accessToken:o.accessToken.value,isError:!0,isSuccess:!1,needsEmailVerification:!1,user:o.user});t.onTransition(c=>{c.matches("registration.incomplete.failed")?i({accessToken:null,error:c.context.errors.registration||null,isError:!0,isSuccess:!1,needsEmailVerification:!1,user:null}):c.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}})?i({accessToken:null,error:null,isError:!1,isSuccess:!1,needsEmailVerification:!0,user:null}):c.matches({authentication:"signedIn",registration:"complete"})&&i({accessToken:c.context.accessToken.value,error:null,isError:!1,isSuccess:!0,needsEmailVerification:!1,user:c.context.user})})}),rs=(t,e,r)=>new Promise(n=>{const{changed:i,context:s}=t.send("SIGNUP_SECURITY_KEY",{email:e,options:r});if(!i)return n({error:oe,accessToken:s.accessToken.value,isError:!0,isSuccess:!1,needsEmailVerification:!1,user:s.user});t.onTransition(o=>{o.matches("registration.incomplete.failed")?n({accessToken:null,error:o.context.errors.registration||null,isError:!0,isSuccess:!1,needsEmailVerification:!1,user:null}):o.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}})?n({accessToken:null,error:null,isError:!1,isSuccess:!1,needsEmailVerification:!0,user:null}):o.matches({authentication:"signedIn",registration:"complete"})&&n({accessToken:o.context.accessToken.value,error:null,isError:!1,isSuccess:!0,needsEmailVerification:!1,user:o.context.user})})});class ns{constructor({url:e,autoRefreshToken:r=!0,autoSignIn:n=!0,clientStorage:i,clientStorageType:s,refreshIntervalTime:o,start:c=!0}){var l;this.url=e,this._client=new Ki({backendUrl:e,clientUrl:typeof window<"u"&&((l=window.location)==null?void 0:l.origin)||"",autoRefreshToken:r,autoSignIn:n,start:c,clientStorage:i,clientStorageType:s,refreshIntervalTime:o})}async signUp(e){const r=await this.waitUntilReady(),{email:n,options:i}=e;return"securityKey"in e?de(await rs(r,n,i)):de(await dr(r,n,e.password,i))}async signIn(e){const r=await this.waitUntilReady();if(!e){const n=await Qi(r);return{...de(n),mfa:null}}if("provider"in e){const{provider:n,options:i}=e,s=qr(`${this._client.backendUrl}/signin/provider/${n}`,ie(this._client.clientUrl,i));return Li()&&(window.location.href=s),{providerUrl:s,provider:n,session:null,mfa:null,error:null}}if("email"in e&&"password"in e){const n=await Wi(r,e.email,e.password);return n.needsEmailVerification?{session:null,mfa:null,error:Si}:n.needsMfaOtp?{session:null,mfa:n.mfa,error:null}:{...de(n),mfa:null}}if("email"in e&&"securityKey"in e){if(e.securityKey!==!0)throw Error("securityKey must be true");const n=await Xi(r,e.email);return{...de(n),mfa:null}}if("email"in e){const{email:n,options:i}=e,{error:s}=await lr(r,n,i);return{session:null,mfa:null,error:s}}if("phoneNumber"in e&&"otp"in e){const n=await es(r,e.phoneNumber,e.otp);return{...de(n),mfa:null}}if("phoneNumber"in e){const{error:n}=await hr(r,e.phoneNumber,e.options);return{error:n,mfa:null,session:null}}if("otp"in e){const n=await Zi(r,e.otp,e.ticket);return{...de(n),mfa:null}}return{error:xi,mfa:null,session:null}}async signOut(e){const r=await this.waitUntilReady(),{error:n}=await ts(r,e==null?void 0:e.all);return{error:n}}async resetPassword({email:e,options:r}){const n=Te(Vi(this._client)).start(),{error:i}=await Yi(n,e,r);return{error:i}}async changePassword({newPassword:e,ticket:r}){const n=Te($i(this._client)).start(),{error:i}=await Hi(n,e,r);return{error:i}}async sendVerificationEmail({email:e,options:r}){const n=Te(qi(this._client)).start(),{error:i}=await Ji(n,e,r);return{error:i}}async changeEmail({newEmail:e,options:r}){const n=Te(Fi(this._client)).start(),{error:i}=await zi(n,e,r);return{error:i}}async deanonymize(e){const r=await this.waitUntilReady();if(e.signInMethod==="passwordless"){if(e.connection==="email"){const{error:n}=await lr(r,e.email,e.options);return{error:n}}if(e.connection==="sms"){const{error:n}=await hr(r,e.phoneNumber,e.options);return{error:n}}}if(e.signInMethod==="email-password"){const{error:n}=await dr(r,e.email,e.password,e.options);return{error:n}}throw Error("Unknown deanonymization method")}async addSecurityKey(e){const{error:r,key:n}=await Gi(this._client,e);return{error:r,key:n}}onTokenChanged(e){return this._client.subscribe(()=>{var r;const n=(r=this._client.interpreter)==null?void 0:r.onTransition(({event:i,context:s})=>{i.type==="TOKEN_CHANGED"&&e(Je(s))});return()=>n==null?void 0:n.stop()})}onAuthStateChanged(e){return this._client.subscribe(()=>{var r;const n=(r=this._client.interpreter)==null?void 0:r.onTransition(({event:i,context:s})=>{(i.type==="SIGNED_IN"||i.type==="SIGNED_OUT")&&e(i.type,Je(s))});return()=>n==null?void 0:n.stop()})}isAuthenticated(){var e;return!!((e=this._client.interpreter)!=null&&e.getSnapshot().matches({authentication:"signedIn"}))}async isAuthenticatedAsync(){return(await this.waitUntilReady()).getSnapshot().matches({authentication:"signedIn"})}getAuthenticationStatus(){var e;const r=((e=this.client.interpreter)==null?void 0:e.getSnapshot().context.importTokenAttempts)||0;return this.isReady()?{isAuthenticated:this.isAuthenticated(),isLoading:!1,connectionAttempts:r}:{isAuthenticated:!1,isLoading:!0,connectionAttempts:r}}getAccessToken(){var e;return((e=this._client.interpreter)==null?void 0:e.getSnapshot().context.accessToken.value)??void 0}getDecodedAccessToken(){const e=this.getAccessToken();return e?mn(e):null}getHasuraClaims(){var e;return((e=this.getDecodedAccessToken())==null?void 0:e["https://hasura.io/jwt/claims"])||null}getHasuraClaim(e){var r;return((r=this.getHasuraClaims())==null?void 0:r[e.startsWith("x-hasura-")?e:`x-hasura-${e}`])||null}async refreshSession(e){try{const r=await this.waitUntilReady();return new Promise(n=>{const i=e||r.getSnapshot().context.refreshToken.value;if(!i)return n({session:null,error:wi});const{changed:s}=r.send("TRY_TOKEN",{token:i});if(!s)return n({session:null,error:Ei});r.onTransition(o=>{o.matches({token:{idle:"error"}})?n({session:null,error:bi}):o.event.type==="TOKEN_CHANGED"&&n({session:Je(o.context),error:null})})})}catch(r){return{session:null,error:r.message}}}getSession(){var e,r;return Je((r=(e=this._client.interpreter)==null?void 0:e.getSnapshot())==null?void 0:r.context)}getUser(){var e,r,n;return((n=(r=(e=this._client.interpreter)==null?void 0:e.getSnapshot())==null?void 0:r.context)==null?void 0:n.user)||null}waitUntilReady(){const e=this._client.interpreter;if(!e)throw Error("Auth interpreter not set");return e.getSnapshot().hasTag("loading")?new Promise((r,n)=>{let i=setTimeout(()=>n(`The state machine is not yet ready after ${15} seconds.`),15e3);e.onTransition(s=>{if(!s.hasTag("loading"))return clearTimeout(i),r(e)})}):Promise.resolve(e)}isReady(){var e,r;return!((r=(e=this._client.interpreter)==null?void 0:e.getSnapshot())!=null&&r.hasTag("loading"))}get client(){return this._client}}var is=typeof self=="object"?self.FormData:window.FormData,ss=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function os(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Mt={exports:{}};(function(t,e){var r=typeof self<"u"?self:ss,n=function(){function s(){this.fetch=!1,this.DOMException=r.DOMException}return s.prototype=r,new s}();(function(s){(function(o){var c={searchParams:"URLSearchParams"in s,iterable:"Symbol"in s&&"iterator"in Symbol,blob:"FileReader"in s&&"Blob"in s&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in s,arrayBuffer:"ArrayBuffer"in s};function l(a){return a&&DataView.prototype.isPrototypeOf(a)}if(c.arrayBuffer)var f=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],u=ArrayBuffer.isView||function(a){return a&&f.indexOf(Object.prototype.toString.call(a))>-1};function h(a){if(typeof a!="string"&&(a=String(a)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(a))throw new TypeError("Invalid character in header field name");return a.toLowerCase()}function d(a){return typeof a!="string"&&(a=String(a)),a}function y(a){var p={next:function(){var w=a.shift();return{done:w===void 0,value:w}}};return c.iterable&&(p[Symbol.iterator]=function(){return p}),p}function v(a){this.map={},a instanceof v?a.forEach(function(p,w){this.append(w,p)},this):Array.isArray(a)?a.forEach(function(p){this.append(p[0],p[1])},this):a&&Object.getOwnPropertyNames(a).forEach(function(p){this.append(p,a[p])},this)}v.prototype.append=function(a,p){a=h(a),p=d(p);var w=this.map[a];this.map[a]=w?w+", "+p:p},v.prototype.delete=function(a){delete this.map[h(a)]},v.prototype.get=function(a){return a=h(a),this.has(a)?this.map[a]:null},v.prototype.has=function(a){return this.map.hasOwnProperty(h(a))},v.prototype.set=function(a,p){this.map[h(a)]=d(p)},v.prototype.forEach=function(a,p){for(var w in this.map)this.map.hasOwnProperty(w)&&a.call(p,this.map[w],w,this)},v.prototype.keys=function(){var a=[];return this.forEach(function(p,w){a.push(w)}),y(a)},v.prototype.values=function(){var a=[];return this.forEach(function(p){a.push(p)}),y(a)},v.prototype.entries=function(){var a=[];return this.forEach(function(p,w){a.push([w,p])}),y(a)},c.iterable&&(v.prototype[Symbol.iterator]=v.prototype.entries);function g(a){if(a.bodyUsed)return Promise.reject(new TypeError("Already read"));a.bodyUsed=!0}function A(a){return new Promise(function(p,w){a.onload=function(){p(a.result)},a.onerror=function(){w(a.error)}})}function T(a){var p=new FileReader,w=A(p);return p.readAsArrayBuffer(a),w}function S(a){var p=new FileReader,w=A(p);return p.readAsText(a),w}function k(a){for(var p=new Uint8Array(a),w=new Array(p.length),R=0;R<p.length;R++)w[R]=String.fromCharCode(p[R]);return w.join("")}function I(a){if(a.slice)return a.slice(0);var p=new Uint8Array(a.byteLength);return p.set(new Uint8Array(a)),p.buffer}function C(){return this.bodyUsed=!1,this._initBody=function(a){this._bodyInit=a,a?typeof a=="string"?this._bodyText=a:c.blob&&Blob.prototype.isPrototypeOf(a)?this._bodyBlob=a:c.formData&&FormData.prototype.isPrototypeOf(a)?this._bodyFormData=a:c.searchParams&&URLSearchParams.prototype.isPrototypeOf(a)?this._bodyText=a.toString():c.arrayBuffer&&c.blob&&l(a)?(this._bodyArrayBuffer=I(a.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):c.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(a)||u(a))?this._bodyArrayBuffer=I(a):this._bodyText=a=Object.prototype.toString.call(a):this._bodyText="",this.headers.get("content-type")||(typeof a=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):c.searchParams&&URLSearchParams.prototype.isPrototypeOf(a)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},c.blob&&(this.blob=function(){var a=g(this);if(a)return a;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?g(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(T)}),this.text=function(){var a=g(this);if(a)return a;if(this._bodyBlob)return S(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(k(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},c.formData&&(this.formData=function(){return this.text().then(D)}),this.json=function(){return this.text().then(JSON.parse)},this}var B=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function P(a){var p=a.toUpperCase();return B.indexOf(p)>-1?p:a}function N(a,p){p=p||{};var w=p.body;if(a instanceof N){if(a.bodyUsed)throw new TypeError("Already read");this.url=a.url,this.credentials=a.credentials,p.headers||(this.headers=new v(a.headers)),this.method=a.method,this.mode=a.mode,this.signal=a.signal,!w&&a._bodyInit!=null&&(w=a._bodyInit,a.bodyUsed=!0)}else this.url=String(a);if(this.credentials=p.credentials||this.credentials||"same-origin",(p.headers||!this.headers)&&(this.headers=new v(p.headers)),this.method=P(p.method||this.method||"GET"),this.mode=p.mode||this.mode||null,this.signal=p.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&w)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(w)}N.prototype.clone=function(){return new N(this,{body:this._bodyInit})};function D(a){var p=new FormData;return a.trim().split("&").forEach(function(w){if(w){var R=w.split("="),_=R.shift().replace(/\+/g," "),b=R.join("=").replace(/\+/g," ");p.append(decodeURIComponent(_),decodeURIComponent(b))}}),p}function q(a){var p=new v,w=a.replace(/\r?\n[\t ]+/g," ");return w.split(/\r?\n/).forEach(function(R){var _=R.split(":"),b=_.shift().trim();if(b){var Z=_.join(":").trim();p.append(b,Z)}}),p}C.call(N.prototype);function x(a,p){p||(p={}),this.type="default",this.status=p.status===void 0?200:p.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in p?p.statusText:"OK",this.headers=new v(p.headers),this.url=p.url||"",this._initBody(a)}C.call(x.prototype),x.prototype.clone=function(){return new x(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new v(this.headers),url:this.url})},x.error=function(){var a=new x(null,{status:0,statusText:""});return a.type="error",a};var L=[301,302,303,307,308];x.redirect=function(a,p){if(L.indexOf(p)===-1)throw new RangeError("Invalid status code");return new x(null,{status:p,headers:{location:a}})},o.DOMException=s.DOMException;try{new o.DOMException}catch{o.DOMException=function(a,p){this.message=a,this.name=p;var w=Error(a);this.stack=w.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function K(a,p){return new Promise(function(w,R){var _=new N(a,p);if(_.signal&&_.signal.aborted)return R(new o.DOMException("Aborted","AbortError"));var b=new XMLHttpRequest;function Z(){b.abort()}b.onload=function(){var G={status:b.status,statusText:b.statusText,headers:q(b.getAllResponseHeaders()||"")};G.url="responseURL"in b?b.responseURL:G.headers.get("X-Request-URL");var se="response"in b?b.response:b.responseText;w(new x(se,G))},b.onerror=function(){R(new TypeError("Network request failed"))},b.ontimeout=function(){R(new TypeError("Network request failed"))},b.onabort=function(){R(new o.DOMException("Aborted","AbortError"))},b.open(_.method,_.url,!0),_.credentials==="include"?b.withCredentials=!0:_.credentials==="omit"&&(b.withCredentials=!1),"responseType"in b&&c.blob&&(b.responseType="blob"),_.headers.forEach(function(G,se){b.setRequestHeader(se,G)}),_.signal&&(_.signal.addEventListener("abort",Z),b.onreadystatechange=function(){b.readyState===4&&_.signal.removeEventListener("abort",Z)}),b.send(typeof _._bodyInit>"u"?null:_._bodyInit)})}return K.polyfill=!0,s.fetch||(s.fetch=K,s.Headers=v,s.Request=N,s.Response=x),o.Headers=v,o.Request=N,o.Response=x,o.fetch=K,Object.defineProperty(o,"__esModule",{value:!0}),o})({})})(n),n.fetch.ponyfill=!0,delete n.fetch.polyfill;var i=n;e=i.fetch,e.default=i.fetch,e.fetch=i.fetch,e.Headers=i.Headers,e.Request=i.Request,e.Response=i.Response,t.exports=e})(Mt,Mt.exports);const jt=os(Mt.exports),as=t=>{try{return btoa(t),t}catch{return encodeURIComponent(t)}},cs=async(t,e,{accessToken:r,name:n,fileId:i,bucketId:s,adminSecret:o,onUploadProgress:c}={})=>{const l={};i&&(l["x-nhost-file-id"]=i),s&&(l["x-nhost-bucket-id"]=s),n&&(l["x-nhost-file-name"]=as(n)),o&&(l["x-hasura-admin-secret"]=o),r&&(l.Authorization=`Bearer ${r}`);const f=`${t}/files`;if(typeof XMLHttpRequest>"u")try{const u=await jt(f,{method:"POST",headers:l,body:e});return u.ok?{fileMetadata:await u.json(),error:null}:{error:{status:u.status,message:await u.text(),error:u.statusText},fileMetadata:null}}catch(u){return{error:{status:0,message:u.message,error:u.message},fileMetadata:null}}return new Promise(u=>{let h=new XMLHttpRequest;h.responseType="json",h.onload=()=>h.status<200&&h.status>=300?u({fileMetadata:null,error:{error:h.statusText,message:h.statusText,status:h.status}}):u({fileMetadata:h.response,error:null}),h.onerror=()=>u({fileMetadata:null,error:{error:h.statusText,message:h.statusText,status:h.status}}),c&&h.upload.addEventListener("progress",c,!1),h.open("POST",f,!0),Object.entries(l).forEach(([d,y])=>{h.setRequestHeader(d,y)}),h.send(e)})};class us{constructor({url:e}){this.url=e}async upload(e){const{formData:r}=e;return cs(this.url,r,{accessToken:this.accessToken,adminSecret:this.adminSecret,bucketId:e.bucketId,fileId:e.id,name:e.name})}async getPresignedUrl(e){try{const{fileId:r}=e,n=await jt(`${this.url}/files/${r}/presignedurl`,{method:"GET",headers:this.generateAuthHeaders()});if(!n.ok)throw new Error(await n.text());return{presignedUrl:await n.json(),error:null}}catch(r){return{presignedUrl:null,error:r}}}async delete(e){try{const{fileId:r}=e,n=await jt(`${this.url}/files/${r}`,{method:"DELETE",headers:this.generateAuthHeaders()});if(!n.ok)throw new Error(await n.text());return{error:null}}catch(r){return{error:r}}}setAccessToken(e){return this.accessToken=e,this}setAdminSecret(e){return this.adminSecret=e,this}generateAuthHeaders(){if(!(!this.adminSecret&&!this.accessToken))return this.adminSecret?{"x-hasura-admin-secret":this.adminSecret}:{Authorization:`Bearer ${this.accessToken}`}}}const ls=(t,e)=>{const r=Object.entries(e).map(([n,i])=>`${Array.from(n)[0]}=${i}`).join("&");return r?`${t}?${r}`:t};class hs{constructor({url:e,adminSecret:r}){this.url=e,this.api=new us({url:e}),this.setAdminSecret(r)}async upload(e){let r;return"file"in e?(r=new is,r.append("file",e.file)):r=e.formData,this.api.upload({...e,formData:r})}getPublicUrl(e){const{fileId:r,...n}=e;return ls(`${this.url}/files/${r}`,n)}async getPresignedUrl(e){const{presignedUrl:r,error:n}=await this.api.getPresignedUrl(e);return n?{presignedUrl:null,error:n}:r?{presignedUrl:r,error:null}:{presignedUrl:null,error:new Error("Invalid file id")}}async delete(e){const{error:r}=await this.api.delete(e);return r?{error:r}:{error:null}}setAccessToken(e){return this.api.setAccessToken(e),this}setAdminSecret(e){return this.api.setAdminSecret(e),this}}function ds(t,e,r){return t.document?t:{document:t,variables:e,config:r}}function fr(t){var e;let r;const n=t.definitions.filter(i=>i.kind==="OperationDefinition");return n.length===1&&(r=(e=n[0].name)==null?void 0:e.value),r}function fs(t){if(typeof t=="string"){let r;try{const n=pn(t);r=fr(n)}catch{}return{query:t,operationName:r}}const e=fr(t);return{query:Qr(t),operationName:e}}class ps{constructor(e){const{url:r,adminSecret:n}=e;this._url=r,this.accessToken=null,this.adminSecret=n}async request(e,...r){const[n,i]=r,s=ds(e,n,i),{headers:o,...c}=i||{},{query:l,operationName:f}=fs(s.document);try{const u=await zt(this.httpUrl,{method:"POST",body:JSON.stringify({operationName:f,query:l,variables:n}),headers:{"Content-Type":"application/json",...this.generateAccessTokenHeaders(),...o},...c});if(!u.ok)return{data:null,error:{error:u.statusText,message:u.statusText,status:u.status}};const{data:h,errors:d}=await u.json();return d?{data:null,error:d}:typeof h!="object"||Array.isArray(h)||h===null?{data:null,error:{error:"invalid-response",message:"incorrect response data from GraphQL server",status:0}}:{data:h,error:null}}catch(u){const h=u;return{data:null,error:{message:h.message,status:h.name==="AbortError"?0:500,error:h.name==="AbortError"?"abort-error":"unknown"}}}}get httpUrl(){return this._url}get wsUrl(){return this._url.replace(/^(http)(s?):\/\//,"ws$2://")}get url(){return this._url}getUrl(){return this._url}setAccessToken(e){if(!e){this.accessToken=null;return}this.accessToken=e}generateAccessTokenHeaders(){return this.adminSecret?{"x-hasura-admin-secret":this.adminSecret}:this.accessToken?{Authorization:`Bearer ${this.accessToken}`}:{}}}const vs=/^((?<protocol>http[s]?):\/\/)?(?<host>localhost)(:(?<port>(\d+|__\w+__)))?$/;function yt(t,e){const{backendUrl:r,subdomain:n,region:i}=t;if(r)return`${r}/v1/${e}`;if(!n)throw new Error("Either `backendUrl` or `subdomain` must be set.");const s=n.match(vs);if(s!=null&&s.groups){const{protocol:o="http",host:c,port:l=1337}=s.groups;return gs(e)||`${o}://${c}:${l}/v1/${e}`}if(!i)throw new Error('`region` must be set when using a `subdomain` other than "localhost".');return`https://${n}.${e}.${i}.nhost.run/v1`}function ys(){return typeof window<"u"}function ms(){return typeof process<"u"&&process.env}function gs(t){return ys()||!ms()?null:process.env[`NHOST_${t.toUpperCase()}_URL`]}function ws(t){const e="subdomain"in t||"backendUrl"in t?yt(t,"auth"):t.authUrl;if(!e)throw new Error("Please provide `subdomain` or `authUrl`.");return new ns({url:e,...t})}function Es(t){const e="subdomain"in t||"backendUrl"in t?yt(t,"functions"):t.functionsUrl;if(!e)throw new Error("Please provide `subdomain` or `functionsUrl`.");return new Ts({url:e,...t})}class Ts{constructor(e){const{url:r,adminSecret:n}=e;this.url=r,this.accessToken=null,this.adminSecret=n}async call(e,r,n){const i={"Content-Type":"application/json",...this.generateAccessTokenHeaders(),...n==null?void 0:n.headers},s=this.url,o=e.startsWith("/")?e:`/${e}`;try{const c=await zt(`${s}/${o}`,{body:JSON.stringify(r),headers:i,method:"POST"});if(!c.ok)throw new Error(c.statusText);let l;return c.headers.get("content-type")==="application/json"?l=await c.json():l=await c.text(),{res:{data:l,status:c.status,statusText:c.statusText},error:null}}catch(c){const l=c;return{res:null,error:{message:l.message,status:l.name==="AbortError"?0:500,error:l.name==="AbortError"?"abort-error":"unknown"}}}}setAccessToken(e){if(!e){this.accessToken=null;return}this.accessToken=e}generateAccessTokenHeaders(){return this.adminSecret?{"x-hasura-admin-secret":this.adminSecret}:this.accessToken?{Authorization:`Bearer ${this.accessToken}`}:{}}}function Ss(t){const e="subdomain"in t||"backendUrl"in t?yt(t,"graphql"):t.graphqlUrl;if(!e)throw new Error("Please provide `subdomain` or `graphqlUrl`.");return new ps({url:e,...t})}function bs(t){const e="subdomain"in t||"backendUrl"in t?yt(t,"storage"):t.storageUrl;if(!e)throw new Error("Please provide `subdomain` or `storageUrl`.");return new hs({url:e,...t})}class xs{constructor({refreshIntervalTime:e,clientStorage:r,clientStorageType:n,autoRefreshToken:i,autoSignIn:s,adminSecret:o,devTools:c,start:l=!0,...f}){this.auth=ws({refreshIntervalTime:e,clientStorage:r,clientStorageType:n,autoRefreshToken:i,autoSignIn:s,start:l,...f}),this.storage=bs({adminSecret:o,...f}),this.functions=Es({adminSecret:o,...f}),this.graphql=Ss({adminSecret:o,...f}),this.auth.onAuthStateChanged((u,h)=>{u==="SIGNED_OUT"&&(this.storage.setAccessToken(void 0),this.functions.setAccessToken(void 0),this.graphql.setAccessToken(void 0))}),this.auth.onTokenChanged(u=>{const h=u==null?void 0:u.accessToken;this.storage.setAccessToken(h),this.functions.setAccessToken(h),this.graphql.setAccessToken(h)}),this._adminSecret=o,this.devTools=c}get adminSecret(){return this._adminSecret}set adminSecret(e){this._adminSecret=e,this.storage.setAdminSecret(e)}}const As=new xs({authUrl:"http://localhost:4000",storageUrl:"localhost:4000",graphqlUrl:"localhost:4000",functionsUrl:"localhost:4000",autoSignIn:!0,autoRefreshToken:!0}),Os=As;export{Os as n};
